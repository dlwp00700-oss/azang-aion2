<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì•„ì´ì˜¨2 ì¥ë¹„ ì‹œë®¬ë ˆì´í„° ì•„ì¥(AZANG). ì¥ë¹„ êµì²´ ì‹œ ì „íˆ¬ë ¥, ë”œëŸ‰, ë°©ì–´ë ¥ì„ ë¯¸ë¦¬ ê³„ì‚°í•´ë³´ì„¸ìš”. ì˜í˜¼ê°ì¸, ë§ˆì„ ì‹œë®¬ë ˆì´ì…˜ ì™„ë²½ ì§€ì›.">
    <meta name="keywords" content="ì•„ì´ì˜¨2, ì¥ë¹„ ì‹œë®¬ë ˆì´í„°, ì „íˆ¬ë ¥ ê³„ì‚°ê¸°, ì•„ì´ì˜¨2 í…œì…‹íŒ…, ì•„ì¥, AZANG, ì˜í˜¼ê°ì¸, ë§ˆì„">
    <meta property="og:title" content="ì•„ì¥(AZANG) - ì•„ì´ì˜¨2 ì¥ë¹„ ë¶„ì„ ì‹œë®¬ë ˆì´í„°">
    <meta property="og:description" content="ë‚´ ìºë¦­í„° ì¥ë¹„ êµì²´ ì‹œë®¬ë ˆì´ì…˜! ë”œëŸ‰ ìƒìŠ¹ê³¼ ìƒì¡´ë ¥ì„ 1ì´ˆ ë§Œì— ê³„ì‚°í•©ë‹ˆë‹¤.">
    
    <title>ì•„ì¥(AZANG) - ì•„ì´ì˜¨2 ì¥ë¹„ ë¶„ì„ ë„ìš°ë¯¸</title>

    <style>
        :root { --bg: #0a0a0c; --panel: #141418; --border: #2a2a35; --accent: #00e676; --accent-hover: #00c853; --pos: #69f0ae; --neg: #ff5252; --text: #e0e0e0; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); padding: 0; font-size: 13px; margin: 0; overflow-x: hidden; }
        
        .main-wrapper { display: flex; justify-content: center; align-items: flex-start; gap: 20px; padding: 15px 20px; max-width: 100vw; box-sizing: border-box; }
        .container { flex: 1; max-width: 1600px; transition: 0.3s; width: 100%; min-width: 0; }
        
        /* ì•„ì§ ì• ë“œì„¼ìŠ¤ ìŠ¹ì¸ ì „ì´ë¯€ë¡œ ê´‘ê³  ì˜ì—­ ì„ì‹œ ìˆ¨ê¹€ */
        .side-ad-area { display: none !important; }
        .ad-banner { display: none !important; }

        .home-mode .logo-container { margin: 80px auto 40px; width: 400px; max-width: 90%; cursor: pointer; transition: 0.3s; }
        .dash-mode .logo-container { margin: 10px auto 20px; width: 250px; cursor: pointer; transition: 0.3s; }
        .logo-container img { width: 100%; height: auto; display: block; }
        
        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜(ì¹´í…Œê³ ë¦¬) ë””ìì¸ */
        .top-nav { background: #141418; border-bottom: 1px solid #2a2a35; display: flex; justify-content: center; gap: 10px; padding: 0 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); flex-wrap: wrap;}
        .nav-item { color: #888; padding: 15px 20px; font-size: 15px; font-weight: bold; cursor: pointer; transition: 0.2s; border-bottom: 3px solid transparent; }
        .nav-item:hover { color: #fff; background: rgba(255,255,255,0.05); border-radius: 6px 6px 0 0;}
        .nav-item.active { color: #00e676; border-bottom-color: #00e676; }
        
        /* íƒ­ í™”ë©´ ì „í™˜ìš© */
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }

        .home-mode #mainDashboard { display: none; }
        .dash-mode #mainDashboard { display: grid; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .search-bar { background: var(--panel); border: 1px solid var(--border); padding: 15px; border-radius: 8px; display: flex; gap: 15px; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.4); margin-bottom: 20px; max-width: 900px; margin-left: auto; margin-right: auto; transition: 0.3s;}
        .search-bar select, .search-bar input { background: #0f0f11; border: 1px solid #333; color: white; padding: 10px; border-radius: 6px; font-size: 14px; }
        .search-bar input { flex: 1; }
        .btn-search { background: var(--accent); color: #000; font-weight: bold; border: none; padding: 10px 25px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .btn-search:hover { background: var(--accent-hover); }

        #favoritesBar { max-width: 900px; margin: 0 auto 20px auto; }
        #characterSelection { max-width: 900px; margin: 0 auto 20px auto; }

        .layout-grid { display: grid; grid-template-columns: 500px 1fr; gap: 20px; align-items: start; }
        .c-window { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 20px; margin-bottom: 20px;}
        .sec-title { font-size: 16px; font-weight: bold; color: #4fc3f7; border-bottom: 1px dashed #333; padding-bottom: 10px; margin-bottom: 15px; display:flex; justify-content:space-between; align-items:flex-end;}
        .cp-display-box { background: rgba(41, 182, 246, 0.1); border: 1px solid rgba(41, 182, 246, 0.4); border-radius: 6px; padding: 15px; text-align: center; margin-bottom: 15px; }

        .stat-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;}
        .stat-grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px;}
        
        .stat-input-group { display: flex; flex-direction: column; gap: 4px; }
        .stat-input-group label { font-size: 11px; color: #aaa; text-align:left;}
        .stat-input-group input { background: #0f0f11; border: 1px solid #333; color: #ccc; padding: 10px; border-radius: 4px; font-weight: bold; text-align: left; font-size: 14px; width: 100%; box-sizing:border-box; transition:0.2s;}
        .stat-input-group input:focus { border-color: #4fc3f7; }
        .highlight-label { color: #ffca28 !important; font-weight:bold; }

        .equip-list-container { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 15px; }
        .equip-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .equip-grid::-webkit-scrollbar { width: 6px; }
        .equip-grid::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        .equip-card { background: #111; border: 1px solid #333; border-radius: 8px; padding: 12px; cursor: pointer; transition: 0.2s; position: relative; }
        .equip-card:hover { border-color: var(--accent); background: #1a1a20; }
        .equip-card.active { border: 2px solid var(--accent); box-shadow: 0 0 15px rgba(0,230,118,0.2); background: #15221a; }
        .equip-card.simulated { border-color: #ff9800; }
        .sim-badge { display: none; position: absolute; top: 5px; right: 5px; background: #ff9800; color: #000; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 4px; }
        .equip-card.simulated .sim-badge { display: block; }
        .item-header { display: flex; align-items: center; gap: 10px; }
        .item-icon { width: 44px; height: 44px; border-radius: 6px; border: 1px solid #444; background: #000; object-fit: cover; }
        .eq-title { font-size: 13px; font-weight: bold; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .eq-enh { color: #fff; margin-right: 4px; }
        .diamond-container { display: flex; align-items: center; gap: 4px; margin-top: 4px; }
        .diamond-pip { width: 6px; height: 6px; background: #333; transform: rotate(45deg); border: 1px solid #555;}
        .diamond-pip.active { background: #ffca28; border-color: #ffd54f; box-shadow: 0 0 4px rgba(255,202,40,0.8); }

        .dash-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .dash-card { background: #111; border: 1px solid #333; border-radius: 8px; padding: 20px; }
        .dash-header { text-align: center; font-weight: bold; font-size: 16px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed #444; }
        .dash-section-title { font-size: 12px; font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 4px; }
        .d-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; color: #aaa; align-items: center;}
        .d-val { font-size: 14px; font-weight: bold; color: #fff; }
        .d-result-box { border: 1px solid #004d40; background: rgba(0, 230, 118, 0.05); padding: 15px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        .d-final-text { text-align: center; font-weight: bold; font-size: 16px; margin-top: 15px; }
        .pos { color: var(--pos); } .neg { color: var(--neg); } .neu { color: #888; }

        .workbench { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 20px; }
        .wb-title { font-size: 16px; font-weight: bold; color: #ffca28; border-bottom: 1px dashed #444; padding-bottom: 10px; margin-bottom: 15px; display:flex; justify-content:space-between; align-items:center;}
        .empty-wb { text-align: center; padding: 150px 0; color: #666; font-size: 15px; }
        .sim-input, .sim-select { background: #0f0f11; border: 1px solid #444; color: white; padding: 10px; border-radius: 6px; width: 100%; box-sizing: border-box; font-size: 13px; }
        .btn-inherit { background: #ffb300; color: #000; border: none; padding: 6px 10px; border-radius: 4px; font-weight: bold; font-size: 11px; cursor: pointer; transition: 0.2s;}
        .btn-inherit:hover { background: #ffca28; }
        .btn-dict-search { background: #4fc3f7; color: #000; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s;}
        .btn-dict-search:hover { background: #29b6f6; }
        .btn-apply { width: 100%; padding: 15px; background: var(--accent); color: #000; border: none; border-radius: 6px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(0, 230, 118, 0.3); margin-top: 15px;}
        .btn-apply:hover { background: var(--accent-hover); }
        .btn-reset { background: #ff5252; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;}

        .compare-container { display: flex; gap: 15px; align-items: stretch; margin-top: 15px; }
        .card-box { flex: 1; background: #0a0a0c; border: 1px solid #333; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; }
        .card-box.new-card { border-color: #00e676; background: #0d1a12; }
        .card-header { text-align: center; font-weight: bold; padding-bottom: 8px; border-bottom: 1px dashed #444; margin-bottom: 10px; }
        .stat-group { background: #111; border-radius: 6px; padding: 10px; border: 1px solid #222; margin-bottom: 10px;}
        .stat-group-title { font-size: 12px; font-weight: bold; margin-bottom: 8px; border-bottom: 1px dashed #444; padding-bottom: 4px; display:flex; justify-content:space-between; align-items:center; }
        .sg-base { color: #4fc3f7; }
        .sg-engrave { color: #ce93d8; }
        .stat-row { display: flex; justify-content: space-between; font-size: 12px; color: #ccc; padding: 4px 0;}
        .stat-row span:last-child { font-weight: bold; color: #fff;}
        .stat-row.positive span:last-child { color: var(--pos); }
        .dict-result-area { max-height: 350px; overflow-y: auto; background: #0f0f11; border: 1px solid #444; border-radius: 6px; margin-top: 10px; display: none; }
        .dict-item { padding: 10px; border-bottom: 1px solid #222; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s;}
        .dict-item:hover { background: #1a1a24; }
        
        .eng-row { display: flex; gap: 5px; margin-bottom: 6px; align-items: center; }
        .eng-row select { background: #111; border: 1px solid #444; color: #ccc; padding: 8px; border-radius: 4px; font-size: 12px; flex: 2; }
        .eng-row input { background: #111; border: 1px solid #444; color: #ccc; padding: 8px; border-radius: 4px; font-size: 12px; flex: 1; min-width: 0;}
        .btn-max { background: #69f0ae; color: #000; border: none; padding: 0 8px; height: 33px; border-radius: 4px; font-size: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center;}
        .btn-max:hover { background: #00e676; }

        .filter-label { display:flex; align-items:center; gap:4px; cursor:pointer; color:#ccc; }
        .filter-label input[type="checkbox"] { margin:0; cursor:pointer; }
        .filter-label:hover { color:#fff; }

        .seo-guide-box { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; margin-top: 20px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        .seo-guide-box summary { font-size: 14px; font-weight: bold; color: #ffca28; cursor: pointer; outline: none; }
        .seo-content { margin-top: 15px; color: #ccc; font-size: 13px; line-height: 1.6; border-top: 1px dashed #333; padding-top: 15px; }
        .seo-content h4 { color: #4fc3f7; margin-bottom: 8px; font-size: 14px; margin-top: 15px; }
        .seo-content ul { padding-left: 20px; margin-bottom: 15px; }
        .seo-content p { margin-bottom: 10px; }

        .site-footer { margin-top: 40px; padding: 30px 20px; text-align: center; border-top: 1px solid #222; background: #0a0a0c; color: #888; font-size: 12px; line-height: 1.8; }
        .footer-links a { color: #aaa; text-decoration: none; margin: 0 10px; transition: 0.2s; }
        .footer-links a:hover { color: #fff; text-decoration: underline; }
        .footer-copy { margin-top: 10px; font-weight: bold; color: #aaa; }
        .footer-desc { margin-top: 5px; font-size: 11px; color: #666; }
    </style>
</head>
<body id="appBody" class="home-mode">

<div class="main-wrapper">
    <div class="side-ad-area">
        <div class="ad-banner-box">[ê´‘ê³ ]<br>ì¢Œì¸¡ ë°°ë„ˆ ì˜ì—­<br>(160x600)</div>
    </div>

    <div class="container">
        <div class="ad-banner ad-top">[ê´‘ê³ ] ìƒë‹¨ ë°°ë„ˆ ì˜ì—­ (728x90)</div>

        <div class="logo-container" onclick="goToHome()">
            <img src="logo.png" alt="AZANG ì•„ì¥ - ì•„ì´ì˜¨2 ì¥ë¹„ ë¶„ì„ ë„ìš°ë¯¸" onerror="this.style.display='none'; this.parentElement.innerHTML='<h1 style=\'color:#00e676; font-size:40px; text-align:center;\'>AZANG</h1><p style=\'text-align:center;\'>ì•„ì´ì˜¨2 ì¥ë¹„ ë¶„ì„ ë„ìš°ë¯¸</p>';">
        </div>

        <div class="top-nav">
            <div class="nav-item active" onclick="switchTab('equip', this)">âš”ï¸ ì¥ë¹„ ì‹œë®¬ë ˆì´í„°</div>
            <div class="nav-item" onclick="switchTab('pet', this)">ğŸ¾ í«ì‘ ê³„ì‚°ê¸°</div>
            <div class="nav-item" onclick="switchTab('abyss', this)">ğŸ… ì–´ë¹„ìŠ¤ íŒŒë° ê³„ì‚°ê¸°</div>
        </div>

        <div id="tab-equip" class="tab-content active">
            <div class="search-bar">
                <select id="searchFaction" onchange="updateServerList()">
                    <option value="1">ğŸ•Šï¸ ì²œì¡±</option>
                    <option value="2">ğŸ¦‡ ë§ˆì¡±</option>
                </select>
                <select id="searchServer">
                    <option value="">ğŸŒ ì „ì²´ ì„œë²„ ë¡œë”© ì¤‘...</option>
                </select>
                <input type="text" id="charNameInput" placeholder="ìºë¦­í„°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”." onkeypress="if(event.keyCode==13) searchCharacter()">
                <button class="btn-search" onclick="searchCharacter()">ë‚´ ìºë¦­í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <span id="statusMsg" style="color: #aaa; margin-left: 10px;">* ì„œë²„ ì—°ë™ ì™„ë£Œ</span>
            </div> 
            
            <div id="favoritesBar" style="background: var(--panel); border: 1px solid var(--border); padding: 12px 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; box-shadow: 0 4px 15px rgba(0,0,0,0.4);">
                <span style="color:#ffca28; font-weight:bold; font-size:14px;">â­ ì¦ê²¨ì°¾ê¸°</span>
                <div id="favoriteList" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;"></div>
            </div>

            <div id="characterSelection" style="display:none; background: #141418; padding: 20px; border-radius: 8px; border: 1px solid #4fc3f7; box-shadow: 0 0 15px rgba(79, 195, 247, 0.2);">
                <h3 style="color: #4fc3f7; margin-top: 0; margin-bottom: 15px; font-size: 16px;">ğŸ” ê²€ìƒ‰ëœ ìºë¦­í„° ëª©ë¡ (ì„ íƒ ì‹œ ë°”ë¡œ ë¡œë“œ)</h3>
                <div id="selectionList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px;"></div>
            </div>

            <div class="layout-grid" id="mainDashboard">
                <div>
                    <div class="c-window" style="padding-bottom: 10px;">
                        <div class="sec-title" style="align-items: center;">
                            <div style="display:flex; flex-direction:column; gap:6px;">
                                <span style="font-size:16px; font-weight:bold; color:#4fc3f7;">ğŸ“Š ë‚´ ìºë¦­í„° ì‹¤ì œ ìŠ¤íƒ¯ (Cì°½)</span>
                                <span style="color:#ffca28; font-size:11px; font-weight:normal;">* ì¥ë¹„ ë³€ê²½ ì „ ê¸°ì¤€ ìŠ¤íƒ¯ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.</span>
                            </div>
                            <div style="display:flex; gap:8px;">
                                <div style="display:flex; flex-direction:column; gap:4px;">
                                    <button onclick="saveStatPreset(1)" style="background:#4fc3f7; color:#000; border:none; padding:6px 12px; border-radius:4px; font-weight:bold; cursor:pointer; font-size:11px; transition:0.2s;">ğŸ’¾ ì €ì¥ 1</button>
                                    <button onclick="loadStatPreset(1)" style="background:#2a2a35; color:#ccc; border:1px solid #444; padding:4px 12px; border-radius:4px; cursor:pointer; font-size:11px; transition:0.2s;" onmouseover="this.style.borderColor='#4fc3f7'; this.style.color='#4fc3f7'" onmouseout="this.style.borderColor='#444'; this.style.color='#ccc'">ğŸ“‚ ë¡œë“œ</button>
                                </div>
                                <div style="display:flex; flex-direction:column; gap:4px;">
                                    <button onclick="saveStatPreset(2)" style="background:#4fc3f7; color:#000; border:none; padding:6px 12px; border-radius:4px; font-weight:bold; cursor:pointer; font-size:11px; transition:0.2s;">ğŸ’¾ ì €ì¥ 2</button>
                                    <button onclick="loadStatPreset(2)" style="background:#2a2a35; color:#ccc; border:1px solid #444; padding:4px 12px; border-radius:4px; cursor:pointer; font-size:11px; transition:0.2s;" onmouseover="this.style.borderColor='#4fc3f7'; this.style.color='#4fc3f7'" onmouseout="this.style.borderColor='#444'; this.style.color='#ccc'">ğŸ“‚ ë¡œë“œ</button>
                                </div>
                                <div style="display:flex; flex-direction:column; gap:4px;">
                                    <button onclick="saveStatPreset(3)" style="background:#4fc3f7; color:#000; border:none; padding:6px 12px; border-radius:4px; font-weight:bold; cursor:pointer; font-size:11px; transition:0.2s;">ğŸ’¾ ì €ì¥ 3</button>
                                    <button onclick="loadStatPreset(3)" style="background:#2a2a35; color:#ccc; border:1px solid #444; padding:4px 12px; border-radius:4px; cursor:pointer; font-size:11px; transition:0.2s;" onmouseover="this.style.borderColor='#4fc3f7'; this.style.color='#4fc3f7'" onmouseout="this.style.borderColor='#444'; this.style.color='#ccc'">ğŸ“‚ ë¡œë“œ</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="cp-display-box">
                            <div style="color:#4fc3f7; font-weight:bold; font-size:12px; margin-bottom:5px;">ğŸ”¥ í˜„ì¬ ì´ ì „íˆ¬ë ¥ (CP)</div>
                            <input type="hidden" id="baseCp" value="0">
                            <div id="cpDiffDisplay" style="font-size:24px; font-weight:bold; color:#fff;">0 â¡ 0 (-)</div>
                        </div>

                        <div class="dash-section-title" style="color:#ffca28; margin-top:10px;">âš”ï¸ ë‚´ ìºë¦­í„° ê³µê²© ìŠ¤íƒ¯</div>
                        <div class="stat-grid-3">
                            <div class="stat-input-group"><label>ì´ ê³µê²©ë ¥(í‘œê¸°)</label><input type="number" id="baseAtk" value="1630"></div>
                            <div class="stat-input-group"><label class="highlight-label">ì¼ë°˜ í”¼í•´ ì¦í­(%)</label><input type="number" id="baseAmp" value="39.6"></div>
                            <div class="stat-input-group"><label>ë¬´ê¸°/ìŠ¤í‚¬ í”¼ì¦(%)</label><input type="number" id="baseWAmp" value="0"></div>
                            <div class="stat-input-group"><label>PVE ì¶”ê°€ í”¼ì¦(%)</label><input type="number" id="basePveAmp" value="0"></div>
                            <div class="stat-input-group"><label>PVP ì¶”ê°€ í”¼ì¦(%)</label><input type="number" id="basePvpAmp" value="0"></div>
                            <div class="stat-input-group"><label>ì¹˜ëª…í”¼ì¦(%)</label><input type="number" id="baseCritDmg" value="0"></div>
                        </div>

                        <div class="dash-section-title" style="color:#69f0ae; margin-top:15px;">ğŸ›¡ï¸ ë‚´ ìºë¦­í„° ë°©ì–´ ìŠ¤íƒ¯</div>
                        <div class="stat-grid-3">
                            <div class="stat-input-group"><label>ì´ ë°©ì–´ë ¥</label><input type="number" id="baseDef" value="2000"></div>
                            <div class="stat-input-group"><label>ì´ ìƒëª…ë ¥</label><input type="number" id="baseHp" value="15000"></div>
                            <div class="stat-input-group"><label>ì¼ë°˜ í”¼í•´ ë‚´ì„±(%)</label><input type="number" id="baseGenRes" value="0"></div>
                            <div class="stat-input-group"><label>PVE í”¼í•´ ë‚´ì„±(%)</label><input type="number" id="basePveRes" value="0"></div>
                            <div class="stat-input-group"><label>PVP í”¼í•´ ë‚´ì„±(%)</label><input type="number" id="basePvpRes" value="0"></div>
                            <div class="stat-input-group" style="visibility:hidden;"><input type="number"></div>
                        </div>

                        <details style="margin-top:15px; background:#111; padding:10px; border-radius:6px; border:1px solid #333;">
                            <summary style="color:#ce93d8; font-weight:bold; cursor:pointer; font-size:12px;">ğŸ§¬ ì£¼ìš”/íŠ¹ìˆ˜ ìŠ¤íƒ¯ ì—°ë™ (í´ë¦­í•˜ì—¬ ì—´ê¸°)</summary>
                            <div style="margin-top:10px; color:#aaa; font-size:11px; margin-bottom:12px; line-height:1.4;">
                                * ì¥ë¹„ êµì²´ë¡œ ì¸í•´ ì•„ë˜ ìŠ¤íƒ¯ì´ ë³€ë™ë  ë•Œ, ê³µì‹ì— ë§ê²Œ <b>ì‹¤ì§ˆ ë”œëŸ‰ê³¼ ìƒì¡´ë ¥ ëŒ€ì‹œë³´ë“œì— ìë™ ë°˜ì˜</b>ë©ë‹ˆë‹¤.
                            </div>
                            <div style="color:#fff; font-size:11px; margin-bottom:6px; padding-bottom:4px; border-bottom:1px solid #222;">ê¸°ë³¸ ìŠ¤íƒ¯ (1ë‹¹ 0.1% íš¨ìœ¨ ë¶€ì—¬)</div>
                            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin-bottom:12px;">
                                <div class="stat-input-group"><label>ìœ„ë ¥</label><input type="number" id="basePower" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ë¯¼ì²©</label><input type="number" id="baseAgi" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì •í™•</label><input type="number" id="baseAccStat" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì˜ì§€</label><input type="number" id="baseWill" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì§€ì‹</label><input type="number" id="baseKnow" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì²´ë ¥</label><input type="number" id="baseVit" value="0" style="padding:6px; font-size:12px;"></div>
                            </div>
                            <div style="color:#fff; font-size:11px; margin-bottom:6px; padding-bottom:4px; border-bottom:1px solid #222;">íŠ¹ìˆ˜ ìŠ¤íƒ¯ (1ë‹¹ 0.2 íš¨ìœ¨ ë¶€ì—¬)</div>
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px;">
                                <div class="stat-input-group"><label>íŒŒê´´</label><input type="number" id="baseDest" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì£½ìŒ</label><input type="number" id="baseDeath" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì§€í˜œ</label><input type="number" id="baseWis" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ìš´ëª…</label><input type="number" id="baseDestiny" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ê³µê°„</label><input type="number" id="baseSpace" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì‹œê°„</label><input type="number" id="baseTime" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ìƒëª…</label><input type="number" id="baseLife" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>í™˜ìƒ</label><input type="number" id="baseIllusion" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ììœ </label><input type="number" id="baseFreedom" value="0" style="padding:6px; font-size:12px;"></div>
                                <div class="stat-input-group"><label>ì •ì˜</label><input type="number" id="baseJustice" value="0" style="padding:6px; font-size:12px;"></div>
                            </div>
                        </details>

                        <div class="dash-section-title" style="color:#ff9800; margin-top:20px;">ğŸ¯ ìƒëŒ€ë°©(ì /ë³´ìŠ¤) ìŠ¤íƒ¯ ê°€ì • <span style="font-size:10px; font-weight:normal; color:#aaa;">* ë°©ì–´ë ¥ ì°¨ê° ê³„ì‚°ì— í•„ìš”í•©ë‹ˆë‹¤.</span></div>
                        <div class="stat-grid-3">
                            <div class="stat-input-group"><label style="color:#ffca28;">ì  í‘œê¸° ê³µê²©ë ¥</label><input type="number" id="enemyAtk" value="8000" style="border-color:#ffca28; color:#ffca28;"></div>
                            <div class="stat-input-group"><label style="color:#ff5252;">ì  ì¼ë°˜ í”¼ì¦(%)</label><input type="number" id="enemyAmp" value="20" style="border-color:#ff5252; color:#ff5252;"></div>
                            <div class="stat-input-group"><label style="color:#ff5252;">ì  PVP í”¼ì¦(%)</label><input type="number" id="enemyPvpAmp" value="10" style="border-color:#ff5252; color:#ff5252;"></div>
                            
                            <div class="stat-input-group" style="visibility:hidden;"><input type="number"></div>
                            <div class="stat-input-group"><label style="color:#4fc3f7;">ì  ì¼ë°˜ í”¼í•´ ë‚´ì„±(%)</label><input type="number" id="enemyGenRes" value="30" style="border-color:#4fc3f7; color:#4fc3f7;"></div>
                            <div class="stat-input-group"><label style="color:#4fc3f7;">ì  PVP í”¼í•´ ë‚´ì„±(%)</label><input type="number" id="enemyPvpRes" value="10" style="border-color:#4fc3f7; color:#4fc3f7;"></div>
                        </div>
                    </div>

                    <div class="equip-list-container">
                        <div class="sec-title">
                            <span>ğŸ›¡ï¸ ì¥ì°© ì¤‘ì¸ ì¥ë¹„ ëª©ë¡</span>
                            <span style="color:#888; font-size:11px; font-weight:normal;">* ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ êµì²´</span>
                        </div>
                        <div id="equipResultArea" class="equip-grid">
                            <div style="grid-column: 1/-1; text-align: center; padding: 80px 0; color: #666;">ìºë¦­í„°ë¥¼ ê²€ìƒ‰í•˜ë©´ í•µì‹¬ ì¥ë¹„ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="dash-container">
                        <div class="dash-card">
                            <div class="dash-header" style="color:#ce93d8; display:flex; justify-content:space-between; align-items:center;">
                                <span>ğŸ‘¾ PVE (ëª¬ìŠ¤í„° ì‚¬ëƒ¥)</span>
                                <label style="font-size:11px; color:#fff; cursor:pointer; background:#332a00; padding:4px 8px; border-radius:4px; border:1px solid #ffca28;">
                                    <input type="checkbox" id="isAbyssToggle" onchange="updateDeltaDashboard()"> ì–´ë¹„ìŠ¤/ì‹œë ¨
                                </label>
                            </div>
                            
                            <div class="dash-section-title" style="color:#ffca28;">âš”ï¸ ê³µê²© ëŠ¥ë ¥</div>
                            <div class="d-row"><span>ìµœì¢… í‘œê¸° ê³µê²©ë ¥</span> <span class="d-val" id="pve-atk">0 â¡ 0</span></div>
                            <div class="d-row"><span>ì´ í”¼ì¦ (ì„¸íŠ¸ í¬í•¨)</span> <span class="d-val" id="pve-amp">0.0% â¡ 0.0%</span></div>
                            <div class="d-row"><span>ì ìš© ë°°ìœ¨ (í”¼ì¦ Ã— ë‚´ì„±ê°ì†Œ)</span> <span class="d-val" id="pve-mult">1.000x â¡ 1.000x</span></div>
                            <div class="d-result-box" style="margin-top:5px; padding:10px;">
                                <span style="color:#00e676; font-weight:bold;">í”¼ì¦ ë°˜ì˜ ì‹¤ì§ˆ ê³µê²©ë ¥</span>
                                <span class="d-val" style="font-size:18px;" id="pve-real-atk">0 â¡ 0</span>
                            </div>
                            <div class="d-final-text" id="pve-final-dps" style="margin-top:10px; font-size:13px;">ì¥ë¹„ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.</div>

                            <div class="dash-section-title" style="color:#69f0ae; margin-top:20px;">ğŸ›¡ï¸ ë°©ì–´ / ìƒì¡´ ëŠ¥ë ¥</div>
                            <div class="d-row"><span>ìµœì¢… ë°©ì–´ë ¥</span> <span class="d-val" id="pve-def">0 â¡ 0</span></div>
                            <div class="d-row"><span>ìµœì¢… ìƒëª…ë ¥</span> <span class="d-val" id="pve-hp">0 â¡ 0</span></div>
                            <div class="d-row"><span>ì  ë‚´ì„±ê´€í†µ í›„ ë°ë¯¸ì§€</span> <span class="d-val" id="pve-incoming">0 â¡ 0</span></div>
                            
                            <div class="d-result-box" style="border-color:#69f0ae; background:rgba(105, 240, 174, 0.05); margin-top:5px; padding:10px;">
                                <span style="color:#69f0ae; font-weight:bold;">ì‹¤ì œ 1íƒ€ë‹¹ í”¼ê²© ë°ë¯¸ì§€ <span style="font-size:10px; font-weight:normal;">(ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)</span></span>
                                <span class="d-val" style="font-size:18px;" id="pve-dmg-taken">0 â¡ 0</span>
                            </div>
                            <div class="d-final-text" id="pve-final-surv" style="margin-top:10px; font-size:13px;">ì¥ë¹„ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.</div>
                        </div>
                        
                        <div class="dash-card">
                            <div class="dash-header" style="color:#ff9800;">âš”ï¸ PVP (ìœ ì € ì „íˆ¬)</div>
                            
                            <div class="dash-section-title" style="color:#ffca28;">âš”ï¸ ê³µê²© ëŠ¥ë ¥</div>
                            <div class="d-row"><span>ìµœì¢… í‘œê¸° ê³µê²©ë ¥</span> <span class="d-val" id="pvp-atk">0 â¡ 0</span></div>
                            <div class="d-row"><span>ì´ í”¼ì¦ (ì„¸íŠ¸ í¬í•¨)</span> <span class="d-val" id="pvp-amp">0.0% â¡ 0.0%</span></div>
                            <div class="d-row"><span>ì ìš© ë°°ìœ¨ (í”¼ì¦ Ã— ë‚´ì„±ê°ì†Œ)</span> <span class="d-val" id="pvp-mult">1.000x â¡ 1.000x</span></div>
                            <div class="d-result-box" style="border-color:#ff9800; background:rgba(255, 152, 0, 0.05); margin-top:5px; padding:10px;">
                                <span style="color:#ff9800; font-weight:bold;">í”¼ì¦ ë°˜ì˜ ì‹¤ì§ˆ ê³µê²©ë ¥</span>
                                <span class="d-val" style="font-size:18px;" id="pvp-real-atk">0 â¡ 0</span>
                            </div>
                            <div class="d-final-text" id="pvp-final-dps" style="margin-top:10px; font-size:13px;">ì¥ë¹„ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.</div>

                            <div class="dash-section-title" style="color:#69f0ae; margin-top:20px;">ğŸ›¡ï¸ ë°©ì–´ / ìƒì¡´ ëŠ¥ë ¥</div>
                            <div class="d-row"><span>ìµœì¢… ë°©ì–´ë ¥</span> <span class="d-val" id="pvp-def">0 â¡ 0</span></div>
                            <div class="d-row"><span>ìµœì¢… ìƒëª…ë ¥</span> <span class="d-val" id="pvp-hp">0 â¡ 0</span></div>
                            <div class="d-row"><span>ì  ë‚´ì„±ê´€í†µ í›„ ë°ë¯¸ì§€</span> <span class="d-val" id="pvp-incoming">0 â¡ 0</span></div>
                            
                            <div class="d-result-box" style="border-color:#69f0ae; background:rgba(105, 240, 174, 0.05); margin-top:5px; padding:10px;">
                                <span style="color:#69f0ae; font-weight:bold;">ì‹¤ì œ 1íƒ€ë‹¹ í”¼ê²© ë°ë¯¸ì§€ <span style="font-size:10px; font-weight:normal;">(ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)</span></span>
                                <span class="d-val" style="font-size:18px;" id="pvp-dmg-taken">0 â¡ 0</span>
                            </div>
                            <div class="d-final-text" id="pvp-final-surv" style="margin-top:10px; font-size:13px;">ì¥ë¹„ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.</div>
                        </div>
                    </div>

                    <div class="workbench" id="workbench">
                        <div class="empty-wb">
                            <div style="font-size:40px; margin-bottom:15px;">ğŸ› ï¸</div>
                            ì™¼ìª½ ëª©ë¡ì—ì„œ <b>ë³€ê²½í•˜ê³  ì‹¶ì€ ì¥ë¹„</b>ë¥¼ í´ë¦­í•˜ì„¸ìš”.
                        </div>
                    </div>

                    <details class="seo-guide-box">
                        <summary>ğŸ“– ì•„ì¥(AZANG) ì‹œë®¬ë ˆì´í„° ì‚¬ìš© ê°€ì´ë“œ ë° ì „íˆ¬ë ¥ ê³µì‹ (í´ë¦­í•˜ì—¬ ë‚´ìš© ë³´ê¸°)</summary>
                        <div class="seo-content">
                            <h4>1. ì•„ì¥(AZANG) ì¥ë¹„ ë¶„ì„ ì‹œë®¬ë ˆì´í„°ë€?</h4>
                            <p>ì•„ì´ì˜¨2 ìœ ì €ë“¤ì„ ìœ„í•œ ìµœì ì˜ í…œì…‹íŒ… ê³„ì‚°ê¸°ì…ë‹ˆë‹¤. ìºë¦­í„°ì˜ í˜„ì¬ ìŠ¤íƒ¯ê³¼ ì¥ë¹„ë¥¼ ë¶ˆëŸ¬ì˜¨ ë’¤, êµì²´í•  ì¥ë¹„ì™€ ì˜í˜¼ ê°ì¸(ë§ˆì„) ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•˜ë©´ ìµœì¢… PVE/PVP ì‹¤ì§ˆ ë°ë¯¸ì§€ì™€ ìƒì¡´ë ¥(í”¼ê²© ë°ë¯¸ì§€ ê°ì†Œìœ¨)ì„ ì •í™•í•˜ê²Œ ì‹œë®¬ë ˆì´ì…˜í•´ ì¤ë‹ˆë‹¤.</p>
                            
                            <h4>2. ì‹œë®¬ë ˆì´í„° 100% í™œìš© ë°©ë²•</h4>
                            <ul>
                                <li><strong>ë‚´ ìºë¦­í„° ë¶ˆëŸ¬ì˜¤ê¸°:</strong> ìƒë‹¨ ê²€ìƒ‰ì°½ì— ì„œë²„ì™€ ìºë¦­í„°ëª…ì„ ì…ë ¥í•˜ì—¬ ë‚´ ì •ë³´ë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤.</li>
                                <li><strong>ìë™ ìŠ¤íƒ¯ ì—°ë™:</strong> 'ì£¼ìš”/íŠ¹ìˆ˜ ìŠ¤íƒ¯ ì—°ë™' íƒ­ì—ì„œ íŒŒê´´, ì£½ìŒ, ì‹œê°„, ê³µê°„ ë“±ì˜ íŠ¹ìˆ˜ ìŠ¤íƒ¯ì´ ë”œëŸ‰/ë°©ì–´ë ¥ ê³µì‹ì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.</li>
                                <li><strong>ì¥ë¹„ êµì²´ ì‹œë®¬ë ˆì´ì…˜:</strong> ì°©ìš© ì¤‘ì¸ ì¥ë¹„ë¥¼ í´ë¦­í•˜ê³ , ìš°ì¸¡ ì‚¬ì „ì—ì„œ ìƒˆë¡œ ë§ì¶œ ì¥ë¹„ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”. ë¬´ê¸° 8ì¢… ë° ë°©ì–´êµ¬ 13ê°œ ë¶€ìœ„ ì™„ë²½ í•„í„°ë§ì„ ì§€ì›í•©ë‹ˆë‹¤.</li>
                            </ul>

                            <h4>3. ì•„ì´ì˜¨2 ì „íˆ¬ë ¥(CP) ë° í…œë ™ 52ì ì˜ ë¹„ë°€</h4>
                            <p>ì¸ê²Œì„ í…œë ™ê³¼ ì¼ë°˜ APIì˜ ìˆ˜ì¹˜ ì°¨ì´ë¥¼ ì•„ì¥(AZANG)ì´ ì™„ë²½í•˜ê²Œ í•´ê²°í–ˆìŠµë‹ˆë‹¤. ì•„ì´í…œ ë ˆë²¨ì€ <strong>[ê¸°ë³¸ ë ˆë²¨] + [ê°•í™” ìˆ˜ì¹˜(+1)] + [ëŒíŒŒ ìˆ˜ì¹˜(+5)] + [ë§ˆì„ ë“±ê¸‰ë³„ ì ìˆ˜]</strong>ë¡œ ì‚°ì •ë©ë‹ˆë‹¤.</p>
                            <p>* ë§ˆì„ ë“±ê¸‰ ê°€ì¤‘ì¹˜: ìœ ì¼/ì˜ì›…(ë…¸ë€ìƒ‰) +4ì , ì „ì„¤(íŒŒë€ìƒ‰) +3ì , í¬ê·€(ì´ˆë¡ìƒ‰) +2ì , ì¼ë°˜(í°ìƒ‰) +1ì  (ë¬´ê¸° ë° ê°€ë”ëŠ” ê¸°ë³¸ +5ì  ì¶”ê°€ ë³´ì •)</p>

                            <h4>4. ì‹¤ì§ˆ ë°©ì–´ë ¥ ë° ìƒì¡´ íƒ€ìˆ˜ ê³µì‹</h4>
                            <p>ë‹¨ìˆœíˆ 'í”¼í•´ ë‚´ì„± %'ë§Œ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ ë„˜ì–´, ì‹¤ì§ˆì ì¸ ë°ë¯¸ì§€ ê°ì‡„ ìˆ˜ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. <br>
                            <strong>ìµœì¢… í”¼ê²© ë°ë¯¸ì§€ = (ì  íƒ€ê²© ë°ë¯¸ì§€ Ã— ìƒëŒ€ í”¼ì¦ Ã— ë‚´ ë‚´ì„± ê°ì‡„ìœ¨) - (ë‚´ ë°©ì–´ë ¥ / 10)</strong><br>
                            ì•„ì¥ ì‹œë®¬ë ˆì´í„°ëŠ” ì´ ê³µì‹ì„ ë°”íƒ•ìœ¼ë¡œ ë‚´ê°€ ëª¬ìŠ¤í„°ë‚˜ ìœ ì €ì—ê²Œ ëª‡ ëŒ€ë¥¼ ë” ë²„í‹¸ ìˆ˜ ìˆëŠ”ì§€(EHP, ìœ íš¨ ìƒëª…ë ¥)ë¥¼ ì§ê´€ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                        </div>
                    </details>
                </div>
            </div>
        </div>
        <div id="tab-pet" class="tab-content">
            <div class="pet-calc-container" style="background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:30px; max-width:900px; margin:0 auto;">
                <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:2px solid #2a2a35; padding-bottom:15px; margin-bottom:20px;">
                    <h2 style="margin:0; color:#ce93d8; font-size:20px;">ğŸ¾ í« ì¢…ì¡± ì´í•´ë„ ì¢…í•© ê³„ì‚°ê¸°</h2>
                </div>
                <table style="width:100%; border-collapse:collapse; margin-bottom:25px;">
                    <thead>
                        <tr style="color:#888; font-size:12px; border-bottom:1px solid #222;">
                            <th style="padding:10px;">ì¹´í…Œê³ ë¦¬</th>
                            <th>í˜„ì¬ ë ˆë²¨</th>
                            <th>í˜„ì¬ ê²½í—˜ì¹˜</th>
                            <th>ëª©í‘œ ë ˆë²¨</th>
                            <th>ì ê¸ˆ ì˜µì…˜</th>
                        </tr>
                    </thead>
                    <tbody id="petTableBody"></tbody>
                </table>
                <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:15px; margin-top:20px;">
                    <div class="pr-card" style="background:#1a1a20; border:1px solid #333; border-radius:10px; padding:15px; text-align:center;">
                        <i style="display:block; font-style:normal; font-size:11px; color:#888; margin-bottom:5px;">ì´ ë¶„ì„ íšŸìˆ˜</i><b id="res_clicks" style="font-size:18px;">0íšŒ</b>
                    </div>
                    <div class="pr-card" style="background:#1a1a20; border:1px solid #333; border-radius:10px; padding:15px; text-align:center;">
                        <i style="display:block; font-style:normal; font-size:11px; color:#888; margin-bottom:5px;">í•„ìš” ì˜í˜¼ê²°ì •</i><b id="res_crystal" style="font-size:18px;">0ê°œ</b>
                    </div>
                    <div class="pr-card" style="background:#1a1a20; border:1px solid #333; border-radius:10px; padding:15px; text-align:center;">
                        <i style="display:block; font-style:normal; font-size:11px; color:#888; margin-bottom:5px;">í•„ìš” í‚¤ë‚˜</i><b id="res_kinah" style="font-size:18px;">0</b>
                    </div>
                    <div class="pr-card" style="background:rgba(255,202,40,0.1); border:1px solid #ffca28; border-radius:10px; padding:15px; text-align:center;">
                        <i style="display:block; font-style:normal; font-size:11px; color:#888; margin-bottom:5px;">í•„ìš” ëª¹ ìˆ˜</i><b id="res_mobs" style="font-size:18px; color:#ffca28;">0ë§ˆë¦¬</b>
                    </div>
                </div>
            </div>
        </div>
        <div id="tab-abyss" class="tab-content">
    <div class="pet-calc-container" style="background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:30px; max-width:1000px; margin:0 auto;">
        <div style="background:linear-gradient(90deg, #1a1a24 0%, #0a0a0c 100%); border:1px solid #4fc3f7; border-radius:10px; padding:20px; margin-bottom:25px; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <h3 style="margin:0; color:#4fc3f7; font-size:14px;">ğŸ“… í˜„ì¬ ì‹œì¦Œ ëˆ„ì  ì–´í¬ í•œë„ (2026-02-20 ê¸°ì¤€)</h3>
                <div id="limit_display" style="font-size:24px; font-weight:bold; color:#fff; margin-top:5px;">5,000,000 AP</div>
            </div>
            <div style="text-align:right;">
                <div style="font-size:12px; color:#888;">ë‹¤ìŒ ê°±ì‹ ì¼: 2ì›” 25ì¼(ìˆ˜)</div>
                <div style="font-size:14px; color:#69f0ae; font-weight:bold;">+500,000 AP ì¶©ì „ ì˜ˆì •</div>
            </div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1.2fr; gap:20px;">
            <div>
                <h3 style="font-size:14px; color:#ffca28; margin-top:0;">1. íŒŒë° ëª©í‘œ ì¥ë¹„ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</h3>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <select id="aby_rank" style="flex:1; padding:8px; background:#111; color:#fff; border:1px solid #444;" onchange="updateAbyTarget()">
                        <option value="10">ì‹­ë¶€ì¥</option><option value="100">ë°±ë¶€ì¥</option>
                        <option value="1000">ì²œë¶€ì¥</option><option value="10000">êµ°ë‹¨ì¥</option>
                    </select>
                    <select id="aby_part" style="flex:1; padding:8px; background:#111; color:#fff; border:1px solid #444;" onchange="updateAbyTarget()">
                        <option value="weapon">ë¬´ê¸°/ê°€ë”</option><option value="top">í‰ê°‘</option>
                        <option value="bottom">ê°ë°˜</option><option value="head">íˆ¬êµ¬</option>
                        <option value="shoulder">ê²¬ê°‘</option><option value="glove">ì¥ê°‘</option>
                        <option value="shoe">ì¥í™”</option><option value="cloak">ë§í† </option>
                        <option value="neck">ëª©ê±¸ì´</option><option value="ear">ê·€ê±¸ì´</option><option value="ring">ë°˜ì§€</option>
                    </select>
                </div>
                <button onclick="addToCart()" style="width:100%; padding:10px; background:#4fc3f7; color:#000; border:none; border-radius:6px; font-weight:bold; cursor:pointer; margin-bottom:15px;">+ ì¶”ê°€</button>
                
                <div id="aby_cart_list" style="background:#0a0a0c; border:1px solid #333; border-radius:8px; min-height:150px; padding:10px;">
                    <p style="text-align:center; color:#444; font-size:12px; margin-top:60px;">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>

            <div>
                <h3 style="font-size:14px; color:#4fc3f7; margin-top:0;">2. ë‚´ í˜„ì¬ ìì› ì •ë³´</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; background:#0a0a0c; padding:15px; border-radius:8px; border:1px solid #333;">
                    <div style="grid-column: span 2;">
                       <label style="font-size:11px; color:#888;">ë‚´ í˜„ì¬ ë³´ìœ  ì–´í¬</label>
                       <input type="number" id="my_ap" value="0" style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; font-size:16px;" oninput="calcAbyss()">
                       <div id="remain_limit_text" style="font-size:11px; color:#ff5252; margin-top:5px;">í•œë„ê¹Œì§€ ë‚¨ì€ íšë“ ê°€ëŠ¥ ì–´í¬: 5,000,000 AP</div>
                    </div>
                    <div style="grid-column: span 2; display:flex; gap:10px;">
                        <div style="flex:1;">
                            <label style="font-size:11px; color:#888;">ì€ ê³µí›ˆ í›ˆì¥</label>
                            <input type="number" id="my_medal_silver" value="0" style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; box-sizing: border-box;" oninput="calcAbyss()">
                        </div>
                        <div style="flex:1;">
                            <label style="font-size:11px; color:#888;">ê¸ˆ ê³µí›ˆ í›ˆì¥</label>
                            <input type="number" id="my_medal_gold" value="0" style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; box-sizing: border-box;" oninput="calcAbyss()">
                        </div>
                        <div style="flex:1;">
                            <label style="font-size:11px; color:#888;">ë°±ê¸ˆ ê³µí›ˆ í›ˆì¥</label>
                            <input type="number" id="my_medal_plat" value="0" style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; box-sizing: border-box;" oninput="calcAbyss()">
                        </div>
                    </div>
                    <div><label style="font-size:11px; color:#888;">ì£¼ê°„ í‰ê·  íšë“ ì–´í¬</label><input type="number" id="week_ap" value="300000" style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff;" oninput="calcAbyss()"></div>
                    <div style="grid-column: span 2; border-top:1px solid #222; padding-top:10px; margin-top:5px;">
                        <label style="font-size:12px; color:#ccc;"><input type="checkbox" id="buy_medal_ap" onchange="calcAbyss()" checked> ì£¼ê°„ ì–´í¬ë¡œ í›ˆì¥ êµ¬ë§¤(10ê°œ)</label><br>
                        <label style="font-size:12px; color:#ccc;"><input type="checkbox" id="make_medal" onchange="calcAbyss()" checked> ì£¼ê°„ í›ˆì¥ ì œì‘ ì‹œë„(20íšŒ)</label>
                    </div>
                </div>

                <div style="margin-top:20px; background:rgba(0,230,118,0.05); border:1px solid #00e676; border-radius:10px; padding:20px; text-align:center;">
                    <div style="font-size:13px; color:#aaa; margin-bottom:5px;">ëª¨ë“  ëª©í‘œ ë‹¬ì„±ê¹Œì§€</div>
                    <div id="aby_res_time" style="font-size:32px; font-weight:bold; color:#fff;">0ì£¼</div>
                    <div id="aby_res_desc" style="font-size:12px; color:#888; margin-top:8px;">-</div>
                </div>
            </div>
        </div>
    </div>
</div>

        
    </div>
</div>
        <div class="ad-banner ad-bottom">
            [ê´‘ê³ ] í•˜ë‹¨ ë°°ë„ˆ ì˜ì—­ (728x90)
        </div>
        
        <footer class="site-footer">
            <div class="footer-links">
                <a href="https://aion2.plaync.com/" target="_blank">AION2 ê³µì‹ í™ˆí˜ì´ì§€</a> | 
                <a href="#">ì´ìš©ì•½ê´€</a> | 
                <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> | 
                <a href="https://discord.gg/N3EV4pxf" target="_blank">1:1 ë¬¸ì˜ (Discord)</a>
            </div>
            <div class="footer-copy">Â© 2026 AZANG (ì•„ì¥) - ì•„ì´ì˜¨2 ì¥ë¹„ ì‹œë®¬ë ˆì´í„°. All rights reserved.</div>
            <div class="footer-desc">
                ë³¸ ì‚¬ì´íŠ¸ëŠ” (ì£¼)ì—”ì”¨ì†Œí”„íŠ¸ì™€ ë¬´ê´€í•œ ë¹„ê³µì‹ íŒ¬ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.<br>
                This site is not associated with NCsoft Corporation. AION2 is a trademark of NCSOFT.
            </div>
        </footer>

    </div>

    <div class="side-ad-area">
        <div class="ad-banner-box">[ê´‘ê³ ]<br>ìš°ì¸¡ ë°°ë„ˆ ì˜ì—­<br>(160x600)</div>
    </div>

</div>

<script>
    const API_BASE = "/api";
    let currentEquipData = []; 
    let simulationState = {}; 
    let activeSlotIndex = -1;
    let activeCategoryInfo = null;
    let currentNewItemAPIData = null;

    const EXCLUDE_KEYWORDS = ['ì•„ë¥´ì¹´ë‚˜', 'ë£¬', 'ì•„ë®¬ë ›', 'ì–‘í”¼ì§€', 'ë‚˜ì¹¨ë°˜', 'ì¢…', 'ê±°ìš¸', 'ì„±ë°°', 'íŒ”ì°Œ', 'ì™¸í˜•', 'ëª…í™”', 'ë‚ ê°œ', 'ëŒíŒŒì„', 'ê³„ìŠ¹ì„', 'ì¡°ìœ¨ì„', 'ê°•í™”ì„', 'ë§ˆì„', 'ì‹ ì„', 'ë„ì•ˆ', 'ë ˆì‹œí”¼', 'ìƒì', 'ì£¼í™”'];

    const CATEGORY_MAP = [
        { key: 'w_longsword', label: 'ì¥ê²€', match: ['ì¥ê²€'], queries: ['ì¥ê²€'] },
        { key: 'w_greatsword', label: 'ëŒ€ê²€', match: ['ëŒ€ê²€'], queries: ['ëŒ€ê²€'] },
        { key: 'w_dagger', label: 'ë‹¨ê²€', match: ['ë‹¨ê²€', 'ë¹„ìˆ˜'], queries: ['ë‹¨ê²€'] },
        { key: 'w_bow', label: 'í™œ', match: ['í™œ', 'ì¥ê¶', 'ê¶'], queries: ['í™œ'] },
        { key: 'w_spellbook', label: 'ë²•ì„œ', match: ['ë²•ì„œ'], queries: ['ë²•ì„œ'] },
        { key: 'w_orb', label: 'ë³´ì£¼', match: ['ë³´ì£¼'], queries: ['ë³´ì£¼'] },
        { key: 'w_mace', label: 'ì „ê³¤', match: ['ì „ê³¤', 'ë§ì¹˜'], queries: ['ì „ê³¤'] },
        { key: 'w_staff', label: 'ë²•ë´‰', match: ['ë²•ë´‰', 'ë©¸ê³¤'], queries: ['ë²•ë´‰'] },
        { key: 'guarder', label: 'ê°€ë”', match: ['ê°€ë”', 'ë°©íŒ¨'], queries: ['ê°€ë”'] },
        { key: 'head', label: 'íˆ¬êµ¬', match: ['íˆ¬êµ¬','ë¨¸ë¦¬','ëª¨ì','ê´€'], queries: ['íˆ¬êµ¬','ë¨¸ë¦¬','ëª¨ì'] },
        { key: 'top', label: 'ìƒì˜', match: ['ìƒì˜','í‰ê°‘','íŠœë‹‰','ì¡°ë¼','ë¡œë¸Œ','ê°€ì£½'], queries: ['ìƒì˜','í‰ê°‘','íŠœë‹‰','ì¡°ë¼'] },
        { key: 'bottom', label: 'í•˜ì˜', match: ['í•˜ì˜','ê°ë°˜','ë°”ì§€'], queries: ['í•˜ì˜','ê°ë°˜','ë°”ì§€'] },
        { key: 'shoulder', label: 'ê²¬ê°‘', match: ['ê²¬ê°‘','ì–´ê¹¨','ì–´ê¹¨ê°‘ì˜·'], queries: ['ê²¬ê°‘','ì–´ê¹¨'] },
        { key: 'glove', label: 'ì¥ê°‘', match: ['ì¥ê°‘'], queries: ['ì¥ê°‘'] },
        { key: 'shoe', label: 'ì‹ ë°œ', match: ['ì‹ ë°œ','ì¥í™”'], queries: ['ì‹ ë°œ','ì¥í™”'] },
        { key: 'cloak', label: 'ë§í† ', match: ['ë§í† '], queries: ['ë§í† '] },
        { key: 'necklace', label: 'ëª©ê±¸ì´', match: ['ëª©ê±¸ì´'], queries: ['ëª©ê±¸ì´'] },
        { key: 'earring', label: 'ê·€ê±¸ì´', match: ['ê·€ê±¸ì´'], queries: ['ê·€ê±¸ì´'] },
        { key: 'ring', label: 'ë°˜ì§€', match: ['ë°˜ì§€'], queries: ['ë°˜ì§€'] }
    ];

    const STAT_KEYS = ["atk", "acc", "amp", "pvpAmp", "pveAmp", "crit", "critDmg", "critAddDmg", "critRes", "hp", "mp", "def", "spd", "multiHit", "shockHit", "power", "agi", "acc_stat", "will", "know", "vit", "dest", "death", "wis", "destiny", "space", "time_stat", "life", "illusion", "freedom", "justice", "rearAtk", "block", "evasion", "wAmp", "atkPct", "defPct", "bossAmp", "raceAmp", "pveRes", "pvpRes", "genRes", "hpPct", "statusRes", "statusAcc"];
    
    function mapStatName(name) {
        if(!name) return null;
        if(name.includes("ê³µê²©ë ¥ ì¦ê°€")) return "atkPct";
        if(name.includes("ë°©ì–´ë ¥ ì¦ê°€")) return "defPct";
        if(name === "ê³µê²©ë ¥" || name === "ë¬¼ë¦¬ ê³µê²©ë ¥" || name === "ë§ˆë²• ê³µê²©ë ¥") return "atk";
        if(name === "ëª…ì¤‘" || name === "ë¬¼ë¦¬ ëª…ì¤‘" || name === "ë§ˆë²• ëª…ì¤‘") return "acc";
        if(name === "í”¼í•´ ì¦í­") return "amp";
        if(name === "ë¬´ê¸° í”¼í•´ ì¦í­") return "wAmp";
        if(name.includes("PVP") && name.includes("í”¼í•´ ì¦í­")) return "pvpAmp";
        if(name.includes("PVE") && name.includes("í”¼í•´ ì¦í­")) return "pveAmp";
        if(name.includes("ì¹˜ëª…íƒ€ í”¼í•´ ì¦í­")) return "critDmg";
        if(name.includes("ì¹˜ëª…íƒ€ ê³µê²©ë ¥")) return "critAddDmg";
        if(name.includes("ë³´ìŠ¤ í”¼í•´ ì¦í­")) return "bossAmp";
        if(name.includes("ì¢…ì¡± í”¼í•´ ì¦í­")) return "raceAmp";
        if(name.includes("ëª¬ìŠ¤í„° í”¼í•´ ë‚´ì„±") || name.includes("PVE í”¼í•´ ë‚´ì„±")) return "pveRes";
        if(name.includes("PVP í”¼í•´ ë‚´ì„±")) return "pvpRes";
        if(name === "í”¼í•´ ë‚´ì„±" || name === "ì¼ë°˜ í”¼í•´ ë‚´ì„±") return "genRes";
        if(name === "ìœ„ë ¥" || name === "STR") return "power";
        if(name === "ë¯¼ì²©" || name === "DEX") return "agi";
        if(name === "ì •í™•" || name === "AGI") return "acc_stat";
        if(name === "ì˜ì§€" || name === "WIS") return "will";
        if(name === "ì§€ì‹" || name === "INT") return "know";
        if(name === "ì²´ë ¥" || name === "CON") return "vit";
        if(name === "íŒŒê´´" || name === "Destruction") return "dest";
        if(name === "ì£½ìŒ" || name === "Death") return "death";
        if(name === "ì§€í˜œ" || name === "Wisdom") return "wis";
        if(name === "ìš´ëª…" || name === "Destiny") return "destiny";
        if(name === "ê³µê°„" || name === "Space") return "space";
        if(name === "ì‹œê°„" || name === "Time") return "time_stat";
        if(name === "ìƒëª…" || name === "Life") return "life";
        if(name === "í™˜ìƒ" || name === "Illusion") return "illusion";
        if(name === "ììœ " || name === "Freedom") return "freedom";
        if(name === "ì •ì˜" || name === "Justice") return "justice";
        if(name === "ì¹˜ëª…íƒ€" || name === "ë¬¼ë¦¬ ì¹˜ëª…íƒ€" || name === "ë§ˆë²• ì¹˜ëª…íƒ€") return "crit";
        if(name === "ì¹˜ëª…íƒ€ ì €í•­" || name === "CriticalResist") return "critRes";
        if(name.includes("ìƒëª…ë ¥")) return "hp";
        if(name.includes("ì •ì‹ ë ¥")) return "mp";
        if(name === "ë°©ì–´ë ¥" || name === "ë¬¼ë¦¬ ë°©ì–´ë ¥" || name === "ë§ˆë²• ë°©ì–´ë ¥") return "def";
        if(name.includes("ì „íˆ¬ ì†ë„")) return "spd";
        return null;
    }

    const STAT_LABEL = { atk:"ê³µê²©ë ¥", acc:"ëª…ì¤‘", amp:"í”¼í•´ ì¦í­(%)", wAmp:"ë¬´ê¸° í”¼ì¦(%)", pvpAmp:"PVP í”¼ì¦(%)", pveAmp:"PVE í”¼ì¦(%)", crit:"ì¹˜ëª…íƒ€", critDmg:"ì¹˜ëª…íƒ€ í”¼í•´ ì¦í­(%)", critAddDmg:"ì¹˜ëª…íƒ€ ê³µê²©ë ¥", critRes:"ì¹˜ëª… ì €í•­", hp:"ìƒëª…ë ¥", mp:"ì •ì‹ ë ¥", def:"ë°©ì–´ë ¥", spd:"ì „íˆ¬ ì†ë„(%)", power:"ìœ„ë ¥", agi:"ë¯¼ì²©", acc_stat:"ì •í™•", will:"ì˜ì§€", know:"ì§€ì‹", vit:"ì²´ë ¥", dest:"íŒŒê´´", death:"ì£½ìŒ", wis:"ì§€í˜œ", destiny:"ìš´ëª…", space:"ê³µê°„", time_stat:"ì‹œê°„", life:"ìƒëª…", illusion:"í™˜ìƒ", freedom:"ììœ ", justice:"ì •ì˜", atkPct:"ê³µê²©ë ¥ ì¦ê°€(%)", defPct:"ë°©ì–´ë ¥ ì¦ê°€(%)", bossAmp:"ë³´ìŠ¤ í”¼ì¦(%)", raceAmp:"ì¢…ì¡± í”¼ì¦(%)", pveRes:"PVE ë‚´ì„±(%)", pvpRes:"PVP ë‚´ì„±(%)", genRes:"ì¼ë°˜ ë‚´ì„±(%)" };

    function findData(obj, key) {
        if (!obj || typeof obj !== 'object') return null;
        if (key in obj) return obj[key];
        for (let k in obj) { const res = findData(obj[k], key); if (res) return res; }
        return null;
    }

    function getGradeColor(grade) {
        if (grade === "Unique") return "#ffca28"; 
        if (grade === "Hero" || grade === "Epic") return "#ff9800"; 
        if (grade === "Rare") return "#69f0ae"; 
        return "#fff";
    }

    function getSmartCategory(item) {
        if (!item) return null;
        let cName = item.categoryName || "";
        let iName = item.name || "";
        let combined = cName + " " + iName;

        for (let cat of CATEGORY_MAP) {
            if (cat.match.some(m => combined.includes(m))) return cat;
        }

        if (iName.endsWith('ê²€')) return CATEGORY_MAP.find(c => c.key === 'w_longsword');
        if (iName.endsWith('ë„')) return CATEGORY_MAP.find(c => c.key === 'w_dagger');
        if (iName.endsWith('í™œ') || iName.endsWith('ê¶')) return CATEGORY_MAP.find(c => c.key === 'w_bow');
        if (iName.endsWith('ê³¤')) return CATEGORY_MAP.find(c => c.key === 'w_mace');
        if (iName.endsWith('ì„œ')) return CATEGORY_MAP.find(c => c.key === 'w_spellbook');
        if (iName.endsWith('ì£¼')) return CATEGORY_MAP.find(c => c.key === 'w_orb');
        if (iName.endsWith('ì¹˜')) return CATEGORY_MAP.find(c => c.key === 'w_mace');
        
        return null;
    }

    function goToHome() {
        document.getElementById('appBody').className = 'home-mode';
        document.getElementById('characterSelection').style.display = 'none';
        document.getElementById('statusMsg').innerHTML = "* ì„œë²„ ì—°ë™ ì™„ë£Œ";
        document.getElementById('charNameInput').value = '';
    }

    let serverListCache = [];
    
    async function updateServerList() {
        const faction = parseInt(document.getElementById('searchFaction').value);
        const serverSelect = document.getElementById('searchServer');
        if (serverListCache.length === 0) {
            try {
                serverSelect.innerHTML = `<option value="">ğŸŒ ì„œë²„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>`;
                const res = await fetch(`${API_BASE}/servers`);
                const data = await res.json();
                serverListCache = data.serverList || [];
            } catch (e) {
                serverSelect.innerHTML = `<option value="">ì„œë²„ ëª©ë¡ ì‹¤íŒ¨ (ìœ ìŠ¤í‹°ì—˜ë¡œ ê²€ìƒ‰ë¨)</option>`;
                return;
            }
        }
        let html = `<option value="">ğŸŒ ì „ì²´ ì„œë²„ ê²€ìƒ‰</option>`;
        const filtered = serverListCache.filter(s => s.raceId === faction);
        filtered.forEach(s => { html += `<option value="${s.serverId}">${s.serverName}</option>`; });
        serverSelect.innerHTML = html;
    }

    function getSetName(itemName) {
        if(!itemName) return null;
        if(itemName.includes("ë°±ë¶€ì¥")) return "ë°±ë¶€ì¥";
        if(itemName.includes("ì²œë¶€ì¥")) return "ì²œë¶€ì¥";
        if(itemName.includes("ì‹­ë¶€ì¥")) return "ì‹­ë¶€ì¥";
        if(itemName.includes("êµ°ë‹¨ì¥")) return "êµ°ë‹¨ì¥";
        return null;
    }

    function calcSetEffects(counts) {
        let eff = { pvpAmp: 0, pveAmp: 0, abyssPveAmp: 0 };
        const rules = {
            "ì‹­ë¶€ì¥": { 2: {pve:-5, ab:10}, 5: {pve:-5, ab:10}, 8: {pve:-5, ab:10}, 12: {pve:-5, ab:10} },
            "ë°±ë¶€ì¥": { 2: {pvp:5, pve:-5, ab:10}, 5: {pve:-5, ab:10}, 8: {pve:-5, ab:10}, 12: {pve:-5, ab:10} },
            "ì²œë¶€ì¥": { 2: {pvp:5, pve:-5, ab:10}, 5: {pve:-5, ab:10}, 8: {pvp:5, pve:-5, ab:10}, 12: {pve:-5, ab:10} },
            "êµ°ë‹¨ì¥": { 2: {pvp:6, pve:-5, ab:10}, 5: {pve:-5, ab:10}, 8: {pvp:6, pve:-5, ab:10}, 12: {pve:-5, ab:10} }
        };
        for(let set in counts) {
            let count = counts[set];
            if(rules[set]) {
                for(let req in rules[set]) {
                    if(count >= parseInt(req)) {
                        eff.pvpAmp += rules[set][req].pvp || 0;
                        eff.pveAmp += rules[set][req].pve || 0;
                        eff.abyssPveAmp += rules[set][req].ab || 0;
                    }
                }
            }
        }
        return eff;
    }

    function extractBaseStats(eq, overrideBrk) {
        let stats = {}; 
        let displayLines = []; 
        if(!eq) return { total: stats, display: displayLines };

        const mStats = findData(eq, 'mainStats') || [];
        const FIXED_STATS = ["pvpAmp", "pveAmp", "amp", "wAmp", "spd", "atkPct", "defPct", "bossAmp", "raceAmp", "pveRes", "pvpRes", "genRes"]; 
        let seenNames = new Set(); 

        mStats.forEach(st => {
            let name = st.name || "ëŠ¥ë ¥ì¹˜";
            let bVal = parseFloat((st.value||"0").toString().replace(/[^0-9.]/g, ''))||0;
            let eVal = parseFloat((st.extra||"0").toString().replace(/[^0-9.]/g, ''))||0;

            let k = mapStatName(name) || mapStatName(st.id) || name; 
            let isFixed = FIXED_STATS.includes(k);

            if (!seenNames.has(name) && !name.includes("ì¦ê°€")) {
                seenNames.add(name);
                stats[k] = (stats[k] || 0) + (bVal + (isFixed ? 0 : eVal)); 
                displayLines.push({ name: name, bVal: bVal, eVal: eVal, isFixed: isFixed, isOrange: false });
            }
        });

        let brkLvl = parseInt(overrideBrk !== undefined ? overrideBrk : (eq.exceedLevel || 0));
        
        if (brkLvl > 0) {
            let catObj = getSmartCategory(eq);
            let catKey = catObj ? catObj.key : 'w_longsword';
            let brkStats = [];

            if (catKey.startsWith('w_') || catKey === 'guarder') {
                brkStats = [ {k:'atk', n:'ê³µê²©ë ¥', v:30*brkLvl}, {k:'atkPct', n:'ê³µê²©ë ¥ ì¦ê°€', v:1*brkLvl, pct:true} ];
            } else if (['necklace', 'earring', 'ring'].includes(catKey)) {
                brkStats = [ {k:'atk', n:'ê³µê²©ë ¥', v:20*brkLvl}, {k:'def', n:'ë°©ì–´ë ¥', v:40*brkLvl}, {k:'atkPct', n:'ê³µê²©ë ¥ ì¦ê°€', v:1*brkLvl, pct:true} ];
            } else { 
                brkStats = [ {k:'def', n:'ë°©ì–´ë ¥', v:80*brkLvl}, {k:'hp', n:'ìƒëª…ë ¥', v:80*brkLvl}, {k:'defPct', n:'ë°©ì–´ë ¥ ì¦ê°€', v:1*brkLvl, pct:true} ];
            }

            brkStats.forEach(s => {
                stats[s.k] = (stats[s.k] || 0) + s.v; 
                displayLines.push({ name: s.n, bVal: s.v, eVal: 0, isFixed: true, isOrange: true, forcePct: s.pct });
            });
        }

        return { total: stats, display: displayLines };
    }

    function extractEngraveStats(eq) {
        let stats = {}; 
        if(!eq) return stats;
        const sStats = findData(eq, 'subStats') || [];
        sStats.forEach(st => {
            let sVal = parseFloat((st.value||"0").toString().replace(/[^0-9.]/g, ''))||0;
            let rawName = st.name;
            let k = mapStatName(rawName) || mapStatName(st.id) || rawName; 
            stats[k] = (stats[k] || 0) + sVal;
        });
        return stats;
    }

    function calculateEquippedCP(eq) {
        let baseLv = parseInt(eq.level || eq.itemLevel || eq.equipLevel || 0);
        let enh = parseInt(eq.enchantLevel || 0);
        let brk = parseInt(eq.exceedLevel || 0);
        
        let catObj = getSmartCategory(eq);
        let isWepGua = catObj && (catObj.key.startsWith('w_') || catObj.key === 'guarder');
        
        let total = baseLv + (enh * 1) + (brk * 5) + (isWepGua ? 5 : 0);
        
        if (eq.magicStoneStat && Array.isArray(eq.magicStoneStat)) {
            eq.magicStoneStat.forEach(ms => {
                let g = ms.grade;
                if(g === 'Unique' || g === 'Epic' || g === 'Hero') total += 4;
                else if(g === 'Legend') total += 3;
                else if(g === 'Rare') total += 2;
                else total += 1;
            });
        }
        return total;
    }

    function calculateNewItemCP(eq, enh, brk) {
        let baseLv = parseInt(eq.level || eq.itemLevel || eq.equipLevel || 0);
        let enhVal = parseInt(enh || 0);
        let brkVal = parseInt(brk || 0);
        
        let catObj = getSmartCategory(eq);
        let isWepGua = catObj && (catObj.key.startsWith('w_') || catObj.key === 'guarder');
        
        return baseLv + (enhVal * 1) + (brkVal * 5) + (isWepGua ? 5 : 0);
    }

    async function searchCharacter() {
        const name = document.getElementById('charNameInput').value.trim();
        const race = document.getElementById('searchFaction').value;
        const serverId = document.getElementById('searchServer').value;
        const statusMsg = document.getElementById('statusMsg');
        const selectionDiv = document.getElementById('characterSelection'); 
        const listDiv = document.getElementById('selectionList'); 

        if(!name) return alert("ìºë¦­í„°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");
        statusMsg.innerHTML = "ğŸ” ê²€ìƒ‰ ì¤‘...";
        selectionDiv.style.display = 'none'; 

        try {
            const listRes = await fetch(`${API_BASE}/searchList?name=${encodeURIComponent(name)}&race=${race}&serverId=${serverId}`);
            const listData = await listRes.json();
            const charList = listData.contents || listData.list || [];

            if (charList.length === 0) { statusMsg.innerHTML = "âŒ ê²€ìƒ‰ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤."; return; }

            statusMsg.innerHTML = `âœ… ${charList.length}ëª…ì˜ ìºë¦­í„° ë°œê²¬`;
            selectionDiv.style.display = 'block'; 
            listDiv.innerHTML = ''; 

            charList.forEach(char => {
                const charCard = document.createElement('div');
                charCard.style.cssText = "padding: 10px 15px; background: #2a2a35; color: white; border: 1px solid #444; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; transition: 0.2s;";
                charCard.onmouseover = () => charCard.style.borderColor = "#4fc3f7";
                charCard.onmouseout = () => charCard.style.borderColor = "#444";

                const charName = char.characterName || char.name || "ì´ë¦„ ì—†ìŒ";
                const serverName = char.serverName || "ì„œë²„ ë¯¸í™•ì¸";
                const level = char.level || "-";
                const className = char.className || char.class || "ì§ì—… ë¯¸í™•ì¸";
                const raceName = char.raceName || char.race || "";

                const infoDiv = document.createElement('div');
                infoDiv.style.cssText = "cursor: pointer; flex: 1;";
                infoDiv.innerHTML = `
                    <div style="font-weight:bold; color:#4fc3f7;">[${serverName}] ${charName}</div>
                    <div style="font-size:11px; color:#aaa; margin-top:4px;">Lv.${level} | ${className} ${raceName ? '| ' + raceName : ''}</div>
                `;
                infoDiv.onclick = () => {
                    selectionDiv.style.display = 'none';
                    loadCharacterDetail(char.characterId, char.serverId || serverId, charName);
                };

                const favBtn = document.createElement('button');
                favBtn.innerHTML = "â­ ì €ì¥";
                favBtn.style.cssText = "background: #111; color: #ffca28; border: 1px solid #555; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; transition: 0.2s; font-weight:bold;";
                favBtn.onmouseover = () => favBtn.style.background = "#332a00";
                favBtn.onmouseout = () => favBtn.style.background = "#111";
                favBtn.onclick = (e) => {
                    e.stopPropagation();
                    addFavorite(char.characterId, char.serverId || serverId, charName, serverName, className);
                };

                charCard.appendChild(infoDiv);
                charCard.appendChild(favBtn);
                listDiv.appendChild(charCard);
            });

        } catch (e) { statusMsg.innerHTML = "âŒ ê²€ìƒ‰ ì˜¤ë¥˜"; }
    }

    async function loadCharacterDetail(characterId, serverId, characterName) {
        const statusMsg = document.getElementById('statusMsg');
        statusMsg.innerHTML = `â³ [${characterName}] ë¶„ì„ ì¤‘...`;

        try {
            const detailRes = await fetch(`${API_BASE}/characterDetail?characterId=${encodeURIComponent(characterId)}&serverId=${serverId}`);
            const data = await detailRes.json();
            
            const statList = data.stat?.statList || data.info?.stat?.statList || [];
            
            let cpStat = statList.find(s => s.type === "ItemLevel" || s.name === "ì•„ì´í…œë ˆë²¨");
            document.getElementById('baseCp').value = cpStat ? cpStat.value : 0;

            const setStat = (id, typeKey, nameKey) => {
                let s = statList.find(x => x.type === typeKey || (x.name && x.name.includes(nameKey)));
                if (s) document.getElementById(id).value = s.value;
            };
            
            setStat('basePower', 'STR', 'ìœ„ë ¥');
            setStat('baseAgi', 'DEX', 'ë¯¼ì²©');
            setStat('baseAccStat', 'AGI', 'ì •í™•');
            setStat('baseWill', 'WIS', 'ì˜ì§€');
            setStat('baseKnow', 'INT', 'ì§€ì‹');
            setStat('baseVit', 'CON', 'ì²´ë ¥');
            setStat('baseDest', 'Destruction', 'íŒŒê´´');
            setStat('baseDeath', 'Death', 'ì£½ìŒ');
            setStat('baseWis', 'Wisdom', 'ì§€í˜œ');
            setStat('baseDestiny', 'Destiny', 'ìš´ëª…');
            setStat('baseSpace', 'Space', 'ê³µê°„');
            setStat('baseTime', 'Time', 'ì‹œê°„');
            setStat('baseLife', 'Life', 'ìƒëª…');
            setStat('baseIllusion', 'Illusion', 'í™˜ìƒ');
            setStat('baseFreedom', 'Freedom', 'ììœ ');
            setStat('baseJustice', 'Justice', 'ì •ì˜');

            const rawEquip = data.equipment?.equipment?.equipmentList || data.equipment?.equipmentList || [];
            currentEquipData = rawEquip.filter(eq => !EXCLUDE_KEYWORDS.some(kw => (eq.name||"").includes(kw)));
            
            simulationState = {}; 
            activeSlotIndex = -1; 
            currentNewItemAPIData = null;
            
            statusMsg.innerHTML = `<span style="color:var(--pos)">âœ… [${characterName}] ë¡œë“œ ì™„ë£Œ!</span>`;
            document.getElementById('appBody').className = 'dash-mode';
            
            renderEquipGrid();
            document.getElementById('workbench').innerHTML = `<div class="empty-wb"><div style="font-size:40px; margin-bottom:15px;">ğŸ› ï¸</div>ì™¼ìª½ ëª©ë¡ì—ì„œ <b>ë³€ê²½í•˜ê³  ì‹¶ì€ ì¥ë¹„</b>ë¥¼ í´ë¦­í•˜ì„¸ìš”.</div>`;
            updateDeltaDashboard();
        } catch (e) { 
            statusMsg.innerHTML = "âŒ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨"; 
        }
    }

    function renderEquipGrid() {
        const grid = document.getElementById('equipResultArea');
        grid.innerHTML = "";
        
        currentEquipData.forEach((eq, index) => {
            const name = eq.name || "ì•Œ ìˆ˜ ì—†ëŠ” ì¥ë¹„";
            const enh = eq.enchantLevel || 0;
            const brk = eq.exceedLevel || 0; 
            const imgTag = eq.icon ? `<img src="${eq.icon}" class="item-icon" onerror="this.style.display='none'">` : `<div class="item-icon"></div>`;
            
            let baseLv = eq.level || eq.itemLevel || eq.equipLevel || "?";
            let bonusHtml = "";

            let diamondsHtml = ''; 
            for (let i = 0; i < 5; i++) diamondsHtml += `<div class="diamond-pip ${i < brk ? 'active' : ''}"></div>`;
            
            const isSimulated = simulationState[index] ? 'simulated' : '';
            const isActive = activeSlotIndex === index ? 'active' : '';

            grid.innerHTML += `
            <div class="equip-card ${isActive} ${isSimulated}" onclick="openWorkbench(${index})">
                <div class="sim-badge">ğŸ”„ ë³€ê²½ë¨</div>
                <div class="item-header">
                    ${imgTag}
                    <div style="min-width:0; width:100%;">
                        <div class="eq-title"><span class="eq-enh">+${enh}</span> <span style="color:${getGradeColor(eq.grade)}">${name}</span></div>
                        <div style="font-size:11px; color:#888;">Lv.${baseLv} ${bonusHtml}</div>
                        <div class="diamond-container">${diamondsHtml}</div>
                    </div>
                </div>
            </div>`;
        });
    }

    function setMaxEngrave(btnElement) {
        const row = btnElement.closest('.eng-row');
        const sel = row.querySelector('.wb-eng-type');
        const input = row.querySelector('.wb-eng-val');

        if(sel.selectedIndex > 0) {
            const maxVal = sel.options[sel.selectedIndex].getAttribute('data-max');
            if(maxVal) {
                input.value = parseFloat(maxVal.replace(/[^0-9.]/g, ''));
                applySimulation(true);
            }
        }
    }

    function openWorkbench(index) {
        activeSlotIndex = index;
        renderEquipGrid(); 
        const eq = currentEquipData[index];
        activeCategoryInfo = getSmartCategory(eq) || {key: 'w_longsword', label: 'ë¬´ê¸°'};
        currentNewItemAPIData = null; 

        let enhOptions = ''; for(let i=0; i<=20; i++) enhOptions += `<option value="${i}">+${i}ê°•</option>`;
        
        let weaponFiltersHtml = CATEGORY_MAP.filter(c => c.key.startsWith('w_')).map(c => `
            <label class="filter-label"><input type="checkbox" class="filter-category" value="${c.key}" ${activeCategoryInfo.key === c.key ? 'checked' : ''} onchange="searchDictItem()"> ${c.label}</label>
        `).join('');

        let armorFiltersHtml = CATEGORY_MAP.filter(c => !c.key.startsWith('w_')).map(c => `
            <label class="filter-label"><input type="checkbox" class="filter-category" value="${c.key}" ${activeCategoryInfo.key === c.key ? 'checked' : ''} onchange="searchDictItem()"> ${c.label}</label>
        `).join('');

        let gradeFiltersHtml = `
            <label class="filter-label"><input type="checkbox" class="filter-grade" value="Unique" checked onchange="searchDictItem()"> ìœ ì¼</label>
            <label class="filter-label"><input type="checkbox" class="filter-grade" value="Epic" checked onchange="searchDictItem()"> ì˜ì›…</label>
            <label class="filter-label"><input type="checkbox" class="filter-grade" value="Rare" onchange="searchDictItem()"> í¬ê·€</label>
        `;

        let html = `
        <div class="wb-title">
            <span>ğŸ› ï¸ ì‹œë®¬ë ˆì´íŒ…: <span style="color:#fff;">[${eq.name.split(' ')[0]||'ì¥ë¹„'}]</span> êµì²´</span>
            <button class="btn-reset" onclick="resetSimulation(${index})">ğŸ”„ ì´ ë¶€ìœ„ ì´ˆê¸°í™”</button>
        </div>

        <div style="background:#111; border:1px solid #222; padding:12px; border-radius:6px; margin-bottom:15px;">
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="text" id="dictSearchInput" class="sim-input" placeholder="ê²€ìƒ‰ì–´ (ì˜ˆ: ë°±ë¶€ì¥... ë¹„ì›Œë‘¬ë„ ë¨!)" style="flex:2;" onkeypress="if(event.keyCode==13) searchDictItem()">
                <button class="btn-dict-search" onclick="searchDictItem()">ğŸ” ì§ì ‘ ê²€ìƒ‰</button>
            </div>
            
            <div style="display:flex; flex-direction:column; gap:12px; font-size:12px; background:#0a0a0c; padding:15px; border-radius:4px; border:1px dashed #333;">
                <div style="display:flex; gap:15px; align-items:center; border-bottom:1px solid #222; padding-bottom:10px;">
                    <span style="color:#ffca28; font-weight:bold; width:45px;">ğŸ’ ë“±ê¸‰</span>
                    ${gradeFiltersHtml}
                </div>
                <div style="display:flex; gap:15px; align-items:flex-start;">
                    <span style="color:#ff5252; font-weight:bold; width:45px; margin-top:2px;">âš”ï¸ ë¬´ê¸°</span>
                    <div style="display:flex; flex-wrap:wrap; gap:8px; flex:1;">
                        ${weaponFiltersHtml}
                    </div>
                </div>
                <div style="display:flex; gap:15px; align-items:flex-start; margin-top:4px;">
                    <span style="color:#4fc3f7; font-weight:bold; width:45px; margin-top:2px;">ğŸ›¡ï¸ ë°©ì–´</span>
                    <div style="display:flex; flex-wrap:wrap; gap:8px; flex:1;">
                        ${armorFiltersHtml}
                    </div>
                </div>
            </div>
        </div>

        <div id="dictResultArea" class="dict-result-area"></div>

        <div class="compare-container">
            <div class="card-box" id="wbOldCard"></div>
            <div style="display:flex; align-items:center; color:#4fc3f7; font-size:24px;">â¡</div>
            <div class="card-box new-card" id="wbNewCard">
                <div class="card-header" style="color:#00e676;">êµì²´ í›„ ì˜ˆìƒ ìŠ¤í™</div>
                <div id="newCardHeader" style="min-height: 60px; display:flex; align-items:center; justify-content:center; color:#666; font-size:12px;">ì‚¬ì „ì—ì„œ ì•„ì´í…œì„ ì„ íƒí•˜ì„¸ìš”.</div>
                
                <div style="display:flex; gap:10px; margin: 10px 0;">
                    <select id="wbEnh" class="sim-select" onchange="updateNewItemByEnhance()">${enhOptions}</select>
                    <select id="wbBrk" class="sim-select" style="color:#ffca28;" onchange="updateNewItemByEnhance()"><option value="0">0ëŒíŒŒ</option><option value="1">1ëŒíŒŒ</option><option value="2">2ëŒíŒŒ</option><option value="3">3ëŒíŒŒ</option><option value="4">4ëŒíŒŒ</option><option value="5">5ëŒíŒŒ</option></select>
                </div>

                <div class="stat-group">
                    <div class="stat-group-title sg-base">ğŸ›¡ï¸ ê¸°ë³¸ ëŠ¥ë ¥ì¹˜ <span style="font-size:10px; color:#888; font-weight:normal;">(ìë™ í•©ì‚°)</span></div>
                    <div id="newBaseStatsDisplay" style="min-height:30px;"></div>
                </div>

                <div class="stat-group" style="margin-bottom:0;">
                    <div class="stat-group-title sg-engrave" style="display:flex; justify-content:space-between; border-bottom:1px dashed #444; padding-bottom:6px;">
                        <span>ğŸ”® ì˜í˜¼ ê°ì¸ (ìµœëŒ€ 6ì¹¸)</span>
                        <button class="btn-inherit" onclick="inheritEnhanceAndEngrave()">â—€ ê¸°ì¡´ ê³„ìŠ¹</button>
                    </div>
                    <div id="wbEngravings" style="margin-top:8px;">
                        <div style="text-align:center; padding:20px 0; color:#666; font-size:12px;">ì•„ì´í…œì„ ì„ íƒí•˜ë©´ ê°ì¸ ëª©ë¡ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>
        </div>
        <div style="text-align:right; font-size:11px; color:#ff9800; margin-top:5px; margin-bottom:10px;">* êµì²´ ì¥ë¹„ì˜ ì•„ì´í…œ ë ˆë²¨(CP)ì€ ë§ˆì„ì´ í¬í•¨ë˜ì§€ ì•Šì€ ê¸°ë³¸ ìˆ˜ì¹˜ì…ë‹ˆë‹¤.</div>
        <button class="btn-apply" onclick="applySimulation()">ğŸš€ ì¥ë¹„ êµì²´ ì ìš©í•˜ê¸° (ë”œëŸ‰/ë°©ì–´ ê³„ì‚°)</button>
        `;

        document.getElementById('workbench').innerHTML = html;
        renderOldCard();
        renderNewCardValues(); 

        if(simulationState[index]) {
            currentNewItemAPIData = simulationState[index].apiData; 
            document.getElementById('wbEnh').value = simulationState[index].rawInput.enh;
            document.getElementById('wbBrk').value = simulationState[index].rawInput.brk;
            renderNewCardValues();
            updateEngraveDropdowns(simulationState[index].rawInput.engravings);
        }

        setTimeout(() => { searchDictItem(); }, 100);
    }

    function updateEngraveDropdowns(savedEngravings = null) {
        if(!currentNewItemAPIData || !currentNewItemAPIData.subStats) return;

        let optionsHtml = `<option value="">ì„ íƒ ì•ˆí•¨</option>`;
        currentNewItemAPIData.subStats.forEach(st => {
            let k = mapStatName(st.name) || mapStatName(st.id) || st.name;
            let maxVal = st.value; 
            optionsHtml += `<option value="${k}" data-max="${maxVal}">${st.name} (ìµœëŒ€ ${maxVal})</option>`;
        });

        let engHtml = ''; 
        for(let i=0; i<6; i++) {
            engHtml += `
            <div class="eng-row">
                <span style="color:#666; width:15px; text-align:center;">${i+1}</span>
                <select class="wb-eng-type" onchange="applySimulation(true)">${optionsHtml}</select>
                <input type="number" class="wb-eng-val" placeholder="ìˆ˜ì¹˜" oninput="applySimulation(true)" step="0.1">
                <button class="btn-max" onclick="setMaxEngrave(this)">MAX</button>
            </div>`;
        }
        document.getElementById('wbEngravings').innerHTML = engHtml;

        if(savedEngravings && savedEngravings.length > 0) {
            const eTypes = document.querySelectorAll('.wb-eng-type'); 
            const eVals = document.querySelectorAll('.wb-eng-val');
            savedEngravings.forEach((s, i) => { 
                if(s && i<eTypes.length && s.type) { 
                    if (!Array.from(eTypes[i].options).some(opt => opt.value === s.type)) {
                        let labelName = STAT_LABEL[s.type] || s.type;
                        eTypes[i].add(new Option(labelName + " (ê³„ìŠ¹ë¨)", s.type));
                    }
                    eTypes[i].value = s.type; 
                    eVals[i].value = s.val; 
                } 
            });
        }
    }

    async function searchDictItem() {
        let keyword = document.getElementById('dictSearchInput').value.trim();
        const resultArea = document.getElementById('dictResultArea');
        
        const checkedGrades = Array.from(document.querySelectorAll('.filter-grade:checked')).map(cb => cb.value);
        const checkedCategories = Array.from(document.querySelectorAll('.filter-category:checked')).map(cb => cb.value);

        resultArea.style.display = 'block';
        resultArea.innerHTML = `<div style="padding:15px; text-align:center; color:#ffca28;">ê²€ìƒ‰ ì¤‘... â³</div>`;

        let queriesToRun = [];
        if (keyword) {
            queriesToRun.push(keyword);
        } else {
            if (checkedCategories.length > 0) {
                checkedCategories.forEach(catKey => {
                    const catObj = CATEGORY_MAP.find(c => c.key === catKey);
                    if (catObj && catObj.queries) queriesToRun.push(...catObj.queries);
                });
            } else {
                queriesToRun = ['ì˜ì›…'];
            }
        }
        
        try {
            queriesToRun = queriesToRun.slice(0, 10);
            
            const fetchPromises = queriesToRun.map(q => 
                fetch(`${API_BASE}/searchDictItem?keyword=${encodeURIComponent(q)}`)
                    .then(res => res.json())
                    .catch(e => ({ list: [] }))
            );

            const results = await Promise.all(fetchPromises);
            
            let allItems = [];
            let seenIds = new Set();
            
            results.forEach(data => {
                let items = data.contents || data.list || [];
                items.forEach(item => {
                    if (!seenIds.has(item.id)) {
                        seenIds.add(item.id);
                        allItems.push(item);
                    }
                });
            });
            
            let items = allItems.filter(item => {
                if (EXCLUDE_KEYWORDS.some(kw => (item.name||"").includes(kw))) return false;
                if (checkedGrades.length > 0 && !checkedGrades.includes(item.grade)) return false;
                
                let itemCat = getSmartCategory(item);
                if (!itemCat) return false; 
                
                if (checkedCategories.length > 0 && !checkedCategories.includes(itemCat.key)) return false;
                
                return true;
            });

            if(items.length === 0) { 
                resultArea.innerHTML = `<div style="padding:15px; text-align:center; color:#ff5252;">ì¡°ê±´ì— ë§ëŠ” ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì¡°ì ˆí•´ë³´ì„¸ìš”!</div>`; 
                return; 
            }
            
            items.sort((a, b) => {
                let lvA = parseInt(a.level || a.itemLevel || a.equipLevel || 0);
                let lvB = parseInt(b.level || b.itemLevel || b.equipLevel || 0);
                return lvB - lvA;
            });

            let html = '';
            items.forEach(item => {
                let dispLv = item.level || item.itemLevel || item.equipLevel || "?";
                html += `<div class="dict-item" onclick="selectDictItem('${item.id}', '${item.name}')">
                    <img src="${item.icon||''}" style="width:36px; height:36px; border-radius:4px; border:1px solid #444;" onerror="this.style.display='none'">
                    <div><div style="color:${getGradeColor(item.grade)}; font-weight:bold; font-size:13px;">${item.name}</div><div style="font-size:11px; color:#888;">Lv.${dispLv} | ${item.gradeName||item.grade}</div></div>
                </div>`;
            });
            resultArea.innerHTML = html;
        } catch(e) { resultArea.innerHTML = `<div style="padding:15px; text-align:center; color:#ff5252;">ê²€ìƒ‰ ì—ëŸ¬!</div>`; }
    }

    async function selectDictItem(id, name, savedEngravings = null) {
        document.getElementById('dictResultArea').innerHTML = `<div style="padding:15px; text-align:center; color:#4fc3f7;">[${name}] ìŠ¤íƒ¯ íŒŒë° ì¤‘... â³</div>`;
        const enh = parseInt(document.getElementById('wbEnh').value) || 0;
        const brk = parseInt(document.getElementById('wbBrk').value) || 0;
        
        try {
            const res = await fetch(`${API_BASE}/getDictItemDetail?id=${id}&enchantLevel=${enh}&exceedLevel=${brk}`);
            currentNewItemAPIData = await res.json();
            document.getElementById('dictResultArea').style.display = 'none';
            
            renderNewCardValues(); 
            updateEngraveDropdowns(savedEngravings); 
            applySimulation(true);
        } catch (e) { alert("ìƒì„¸ ìŠ¤íƒ¯ ì‹¤íŒ¨"); document.getElementById('dictResultArea').style.display = 'none'; }
    }

    function updateNewItemByEnhance() {
        if(!currentNewItemAPIData) { return; }
        
        let currentEngravings = [];
        const eTypes = document.querySelectorAll('.wb-eng-type'); 
        const eVals = document.querySelectorAll('.wb-eng-val');
        if (eTypes.length > 0) {
            for(let i=0; i<6; i++) {
                currentEngravings.push({ type: eTypes[i].value, val: eVals[i].value });
            }
        }
        
        selectDictItem(currentNewItemAPIData.id, currentNewItemAPIData.name, currentEngravings.length ? currentEngravings : null);
    }

    function renderOldCard() {
        const oldEq = currentEquipData[activeSlotIndex];
        const oldCard = document.getElementById('wbOldCard');

        const oImg = oldEq.icon ? `<img src="${oldEq.icon}" style="width:44px; height:44px; border-radius:6px; border:1px solid #444;" onerror="this.style.display='none'">` : '';
        const extracted = extractBaseStats(oldEq); 
        const oEngraveStats = extractEngraveStats(oldEq);
        const oCp = calculateEquippedCP(oldEq); 
        
        let baseLv = oldEq.level || oldEq.itemLevel || oldEq.equipLevel || "?";
        let oBase = parseInt(baseLv) || 0;
        let oBonus = oCp - oBase;
        
        let bonusHtml = "";
        let diamondsHtml = ''; for (let i = 0; i < 5; i++) diamondsHtml += `<div class="diamond-pip ${i < (oldEq.exceedLevel||0) ? 'active' : ''}"></div>`;

        let bHtml = '';
        extracted.display.forEach(line => {
            let label = STAT_LABEL[line.name] || line.name;
            let unit = (line.isFixed || line.forcePct || label.includes('%') || label.includes('ì¦ê°€') || label.includes('ë‚´ì„±') || label.includes('ì¦í­')) ? '%' : '';
            let valText = '';

            if (line.isOrange) {
                valText = `<span style="color:#ff9800; font-weight:bold;">${line.bVal}${unit}</span>`;
                label = `<span style="color:#ff9800; font-weight:bold;">${label}</span>`;
            } else {
                valText = `${line.bVal}${unit}`;
                if (line.eVal > 0 && !line.isFixed) { valText += ` <span style="color:#4fc3f7;">(+${line.eVal})</span>`; }
            }
            bHtml += `<div class="stat-row"><span>${label}</span> <span>${valText}</span></div>`;
        });

        let oHtml = `
            <div class="card-header" style="color:#888;">í˜„ì¬ ì¥ì°© ì¤‘ì¸ ì•„ì´í…œ</div>
            <div style="display:flex; align-items:center; gap:10px; margin-top:10px; padding-bottom:10px; border-bottom:1px solid #222;">
                ${oImg}
                <div>
                    <div style="color:${getGradeColor(oldEq.grade)}; font-weight:bold; font-size:14px;">+${oldEq.enchantLevel||0} ${oldEq.name}</div>
                    <div style="font-size:11px; color:#888; margin:2px 0;">Lv.${oBase} <span style="color:#4fc3f7; font-weight:bold;">(+${oBonus})</span></div>
                    <div style="display:flex; align-items:center; gap:6px;"><div class="diamond-container">${diamondsHtml}</div></div>
                </div>
            </div>
            <div style="flex:1; margin-top:10px; display:flex; flex-direction:column; gap:10px;">
                <div class="stat-group">
                    <div class="stat-group-title sg-base">ğŸ›¡ï¸ ê¸°ë³¸ ëŠ¥ë ¥ì¹˜</div>
                    ${bHtml || '<div style="color:#666; font-size:11px; text-align:center;">ê¸°ë³¸ ëŠ¥ë ¥ì¹˜ ì—†ìŒ</div>'}
                </div>
                <div class="stat-group"><div class="stat-group-title sg-engrave">ğŸ”® ì˜í˜¼ ê°ì¸ & ë§ˆì„</div>`;
        
        let hasOEng = false;
        for(let k in oEngraveStats) { 
            if(oEngraveStats[k] > 0) { 
                let label = STAT_LABEL[k] || k;
                oHtml += `<div class="stat-row"><span>${label}</span> <span>${oEngraveStats[k]}</span></div>`; 
                hasOEng = true; 
            } 
        }
        if(!hasOEng) oHtml += `<div style="color:#666; font-size:11px; text-align:center;">ê°ì¸ ì—†ìŒ</div>`;
        oHtml += `</div></div>`;
        oldCard.innerHTML = oHtml;
    }

    function renderNewCardValues() {
        if(!currentNewItemAPIData) return;
        
        const nEq = currentNewItemAPIData;
        const enh = parseInt(document.getElementById('wbEnh').value) || 0;
        const brk = parseInt(document.getElementById('wbBrk').value) || 0;
        
        let baseLv = nEq.level || nEq.itemLevel || nEq.equipLevel || "?";
        let diamondsHtml = ''; for (let i = 0; i < 5; i++) diamondsHtml += `<div class="diamond-pip ${i < brk ? 'active' : ''}"></div>`;

        const nCp = calculateNewItemCP(nEq, enh, brk); 
        let nBase = parseInt(baseLv) || 0;
        let nBonus = nCp - nBase;

        const nImg = nEq.icon ? `<img src="${nEq.icon}" style="width:44px; height:44px; border-radius:6px; border:1px solid #444;" onerror="this.style.display='none'">` : '';

        document.getElementById('newCardHeader').innerHTML = `
            ${nImg}
            <div style="text-align:left;">
                <div style="color:${getGradeColor(nEq.grade)}; font-weight:bold; font-size:14px;">+${enh} ${nEq.name}</div>
                <div style="font-size:11px; color:#888; margin:2px 0;">Lv.${nBase} <span style="color:#4fc3f7; font-weight:bold;">(+${nBonus})</span></div>
                <div style="display:flex; align-items:center; gap:6px;"><div class="diamond-container">${diamondsHtml}</div></div>
            </div>
        `;

        const extracted = extractBaseStats(nEq, brk);

        let bHtml = '';
        extracted.display.forEach(line => {
            let label = STAT_LABEL[line.name] || line.name;
            let unit = (line.isFixed || line.forcePct || label.includes('%') || label.includes('ì¦ê°€') || label.includes('ë‚´ì„±') || label.includes('ì¦í­')) ? '%' : '';
            let valText = '';

            if (line.isOrange) {
                valText = `<span style="color:#ff9800; font-weight:bold;">${line.bVal}${unit}</span>`;
                label = `<span style="color:#ff9800; font-weight:bold;">${label}</span>`;
            } else {
                valText = `${line.bVal}${unit}`;
                if (line.eVal > 0 && !line.isFixed) { valText += ` <span style="color:#4fc3f7;">(+${line.eVal})</span>`; }
            }
            bHtml += `<div class="stat-row"><span>${label}</span> <span>${valText}</span></div>`;
        });

        document.getElementById('newBaseStatsDisplay').innerHTML = bHtml || '<div style="color:#666; font-size:11px; text-align:center;">ê¸°ë³¸ ëŠ¥ë ¥ì¹˜ ì—†ìŒ</div>';
    }

    function inheritEnhanceAndEngrave() {
        if(activeSlotIndex === -1 || !currentNewItemAPIData) return;
        const eq = currentEquipData[activeSlotIndex];
        
        document.getElementById('wbEnh').value = Math.min(eq.enchantLevel || 0, 20);
        document.getElementById('wbBrk').value = eq.exceedLevel || 0;
        
        const sStats = findData(eq, 'subStats') || [];
        let inheritedEngravings = [];
        
        for(let i=0; i<6; i++) {
            if(i < sStats.length) {
                let sub = sStats[i];
                let rawName = sub.name;
                let mappedType = mapStatName(rawName) || mapStatName(sub.id) || rawName;
                inheritedEngravings.push({
                    type: mappedType,
                    val: parseFloat((sub.value || "0").toString().replace(/[^0-9.]/g, '')) || 0
                });
            } else {
                inheritedEngravings.push({ type: "", val: "" });
            }
        }
        
        selectDictItem(currentNewItemAPIData.id, currentNewItemAPIData.name, inheritedEngravings);
    }

    function applySimulation(isAuto = false) {
        if(activeSlotIndex === -1 || !currentNewItemAPIData) {
            if(!isAuto) alert("ìƒˆ ì•„ì´í…œì„ ê²€ìƒ‰í•˜ì—¬ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }
        const rawInput = { enh: document.getElementById('wbEnh').value, brk: document.getElementById('wbBrk').value, engravings: [] };
        
        let nEngraveStats = {}; 
        const eTypes = document.querySelectorAll('.wb-eng-type'); const eVals = document.querySelectorAll('.wb-eng-val');
        
        for(let i=0; i<6; i++) {
            rawInput.engravings.push({ type: eTypes[i].value, val: eVals[i].value });
            if(eTypes[i].value) nEngraveStats[eTypes[i].value] = (nEngraveStats[eTypes[i].value] || 0) + (parseFloat(eVals[i].value)||0);
        }

        let totalStats = extractBaseStats(currentNewItemAPIData, rawInput.brk).total;
        for(let k in nEngraveStats) { totalStats[k] = (totalStats[k] || 0) + nEngraveStats[k]; }
        
        const nCp = calculateNewItemCP(currentNewItemAPIData, rawInput.enh, rawInput.brk);

        simulationState[activeSlotIndex] = { stats: totalStats, cp: nCp, rawInput: rawInput, apiData: currentNewItemAPIData };
        
        if(!isAuto) renderEquipGrid();
        updateDeltaDashboard(); 
    }

    function resetSimulation(index) {
        delete simulationState[index];
        openWorkbench(index); renderEquipGrid(); updateDeltaDashboard();
    }

    function updateDeltaDashboard() {
        const base = {
            cp: parseInt(document.getElementById('baseCp').value) || 0,
            atk: parseInt(document.getElementById('baseAtk').value) || 0,
            def: parseInt(document.getElementById('baseDef').value) || 0,
            hp: parseInt(document.getElementById('baseHp').value) || 0,
            amp: parseFloat(document.getElementById('baseAmp').value) || 0,
            pveAmp: parseFloat(document.getElementById('basePveAmp').value) || 0,
            pvpAmp: parseFloat(document.getElementById('basePvpAmp').value) || 0,
            wAmp: parseFloat(document.getElementById('baseWAmp').value) || 0,
            critDmg: parseFloat(document.getElementById('baseCritDmg').value) || 0,
            genRes: parseFloat(document.getElementById('baseGenRes').value) || 0,
            pveRes: parseFloat(document.getElementById('basePveRes').value) || 0,
            pvpRes: parseFloat(document.getElementById('basePvpRes').value) || 0,
            enemyGenRes: parseFloat(document.getElementById('enemyGenRes').value) || 0,
            enemyPvpRes: parseFloat(document.getElementById('enemyPvpRes').value) || 0,
            enemyAmp: parseFloat(document.getElementById('enemyAmp').value) || 0,
            enemyPvpAmp: parseFloat(document.getElementById('enemyPvpAmp').value) || 0,
            enemyAtk: parseFloat(document.getElementById('enemyAtk').value) || 8000,
            acc: 0, crit: 0, spd: 0 
        };

        let delta = {};
        STAT_KEYS.forEach(k => delta[k] = 0);
        delta.cp = 0;
        
        let oSetCounts = {};
        currentEquipData.forEach(eq => { let sName = getSetName(eq.name); if(sName) oSetCounts[sName] = (oSetCounts[sName] || 0) + 1; });
        let nSetCounts = { ...oSetCounts };

        for (let idx in simulationState) {
            const oldEq = currentEquipData[idx];
            const oldBase = extractBaseStats(oldEq).total; 
            const oldEng = extractEngraveStats(oldEq);
            
            const oldCp = calculateEquippedCP(oldEq);
            const newCp = simulationState[idx].cp; 

            const newEqStats = simulationState[idx].stats; 

            delta.cp += (newCp - oldCp);
            for(let k in newEqStats) { delta[k] = (delta[k] || 0) + newEqStats[k]; }
            for(let k in oldBase) { delta[k] = (delta[k] || 0) - oldBase[k]; }
            for(let k in oldEng) { delta[k] = (delta[k] || 0) - oldEng[k]; }

            let oSet = getSetName(oldEq.name); if(oSet) nSetCounts[oSet]--;
            let nSet = getSetName(simulationState[idx].apiData.name); if(nSet) nSetCounts[nSet] = (nSetCounts[nSet] || 0) + 1;
        }

        let oSetEff = calcSetEffects(oSetCounts);
        let nSetEff = calcSetEffects(nSetCounts);

        delta.pvpAmp += (nSetEff.pvpAmp - oSetEff.pvpAmp);
        delta.pveAmp += (nSetEff.pveAmp - oSetEff.pveAmp);

        delta.atkPct = (delta.atkPct || 0) + (delta.power || 0) * 0.1;
        delta.evasion = (delta.evasion || 0) + (delta.agi || 0) * 0.1;
        delta.block = (delta.block || 0) + (delta.agi || 0) * 0.1;
        delta.critRes = (delta.critRes || 0) + (delta.agi || 0) * 0.1;
        delta.acc = (delta.acc || 0) + (delta.acc_stat || 0) * 0.1;
        delta.crit = (delta.crit || 0) + (delta.acc_stat || 0) * 0.1;
        delta.statusRes = (delta.statusRes || 0) + (delta.will || 0) * 0.1;
        delta.statusAcc = (delta.statusAcc || 0) + (delta.know || 0) * 0.1;
        delta.hpPct = (delta.hpPct || 0) + (delta.vit || 0) * 0.1;

        delta.atk = (delta.atk || 0) + (delta.dest || 0) * 0.2;
        delta.crit = (delta.crit || 0) + (delta.death || 0) * 0.2;
        delta.mp = (delta.mp || 0) + (delta.destiny || 0) * 0.2;
        delta.block = (delta.block || 0) + (delta.space || 0) * 0.2;
        delta.spd = (delta.spd || 0) + (delta.time_stat || 0) * 0.2;
        delta.hp = (delta.hp || 0) + (delta.life || 0) * 0.2;
        delta.acc = (delta.acc || 0) + (delta.freedom || 0) * 0.2;
        delta.evasion = (delta.evasion || 0) + (delta.freedom || 0) * 0.2;
        delta.def = (delta.def || 0) + (delta.justice || 0) * 0.2;

        const finalCp = base.cp + delta.cp;
        const cpDiffEl = document.getElementById('cpDiffDisplay');
        if(delta.cp > 0) cpDiffEl.innerHTML = `<span>${base.cp} â¡ <span style="color:#fff;">${finalCp}</span></span> <span class="pos" style="font-size:16px;">(â–² ${delta.cp})</span>`;
        else if(delta.cp < 0) cpDiffEl.innerHTML = `<span>${base.cp} â¡ <span style="color:#fff;">${finalCp}</span></span> <span class="neg" style="font-size:16px;">(â–¼ ${Math.abs(delta.cp)})</span>`;
        else cpDiffEl.innerHTML = `<span style="color:#ccc;">${base.cp} â¡ ${finalCp} (-)</span>`;

        function formatDiff(oldV, newV, isPct=false) {
            let diff = newV - oldV;
            if(Math.abs(diff) < 0.001) return `<span style="color:#888;">${newV.toFixed(isPct?1:0)}${isPct?'%':''} â¡ ${newV.toFixed(isPct?1:0)}${isPct?'%':''} (-)</span>`;
            let color = diff > 0 ? 'pos' : 'neg'; let arrow = diff > 0 ? 'â–²' : 'â–¼';
            return `<span>${oldV.toFixed(isPct?1:0)}${isPct?'%':''}</span> â¡ <span class="${color}">${newV.toFixed(isPct?1:0)}${isPct?'%':''} (${arrow}${Math.abs(diff).toFixed(isPct?1:0)}${isPct?'%':''})</span>`;
        }
        function formatMultDiff(oldV, newV) {
            let diff = newV - oldV;
            if(Math.abs(diff) < 0.001) return `<span style="color:#888;">${newV.toFixed(3)}x â¡ ${newV.toFixed(3)}x (-)</span>`;
            let color = diff > 0 ? 'pos' : 'neg'; let arrow = diff > 0 ? 'â–²' : 'â–¼';
            return `<span>${oldV.toFixed(3)}x</span> â¡ <span class="${color}">${newV.toFixed(3)}x (${arrow}${Math.abs(diff).toFixed(3)})</span>`;
        }
        
        function formatDmgDiff(oldV, newV) {
            let diff = newV - oldV;
            if(Math.abs(diff) < 0.5) return `<span style="color:#888;">${newV.toFixed(0)} â¡ ${newV.toFixed(0)} (-)</span>`;
            let color = diff < 0 ? 'pos' : 'neg'; 
            let arrow = diff < 0 ? 'â–¼' : 'â–²';
            return `<span>${oldV.toFixed(0)}</span> â¡ <span class="${color}" style="font-weight:bold;">${newV.toFixed(0)} <span style="font-size:11px; font-weight:normal;">(${arrow}${Math.abs(diff).toFixed(0)})</span></span>`;
        }

        let isAbyss = document.getElementById('isAbyssToggle').checked;

        let oDef = base.def; 
        let nDef = (base.def + delta.def) * (1 + (delta.defPct||0)/100); 
        let oHp = base.hp; 
        let nHp = (base.hp + delta.hp) * (1 + (delta.hpPct||0)/100);

        let oPveAtk = base.atk; 
        let nPveAtk = (base.atk + delta.atk) * (1 + (delta.atkPct||0)/100); 

        let oPveAmpSum = (base.amp + base.pveAmp + (isAbyss ? oSetEff.abyssPveAmp : 0)) / 100;
        let nPveAmpSum = (base.amp + base.pveAmp + delta.amp + delta.pveAmp + (isAbyss ? nSetEff.abyssPveAmp : 0)) / 100;
        let oWeaponAmp = base.wAmp / 100; let nWeaponAmp = (base.wAmp + delta.wAmp) / 100;

        let pveResFactor = (1 - base.enemyGenRes/100);
        let oPveMult = Math.max(0.1, (1 + oPveAmpSum) * (1 + oWeaponAmp) * pveResFactor); 
        let nPveMult = Math.max(0.1, (1 + nPveAmpSum) * (1 + nWeaponAmp) * pveResFactor);
        
        let oPveReal = oPveAtk * oPveMult; 
        let nPveReal = nPveAtk * nPveMult;

        document.getElementById('pve-atk').innerHTML = formatDiff(oPveAtk, nPveAtk);
        document.getElementById('pve-amp').innerHTML = formatDiff(oPveAmpSum*100, nPveAmpSum*100, true);
        document.getElementById('pve-mult').innerHTML = formatMultDiff(oPveMult, nPveMult);
        
        let pveRealDiff = nPveReal - oPveReal;
        document.getElementById('pve-real-atk').innerHTML = `${oPveReal.toFixed(0)} â¡ ${nPveReal.toFixed(0)} <span style="font-size:14px;" class="${pveRealDiff>0?'pos':(pveRealDiff<0?'neg':'neu')}">(${pveRealDiff>0?'â–²':'â–¼'}${Math.abs(pveRealDiff).toFixed(0)})</span>`;

        let oCritMult = 1.5 + (base.critDmg / 100);
        let nCritMult = 1.5 + ((base.critDmg + delta.critDmg) / 100);
        let oPveCritReal = oPveReal * oCritMult; let nPveCritReal = nPveReal * nCritMult;
        let pveDpsDiff = (oPveCritReal > 0) ? ((nPveCritReal / oPveCritReal) - 1) * 100 : 0;
        
        const pveEl = document.getElementById('pve-final-dps');
        if(pveDpsDiff > 0) pveEl.innerHTML = `<span class="pos">â–² ì¹˜ëª…íƒ€ ì ì¤‘ ì‹œ ì‹¤ì§ˆ ë”œëŸ‰ ${pveDpsDiff.toFixed(2)}% ì¦ê°€</span>`;
        else if(pveDpsDiff < 0) pveEl.innerHTML = `<span class="neg">â–¼ ì¹˜ëª…íƒ€ ì ì¤‘ ì‹œ ì‹¤ì§ˆ ë”œëŸ‰ ${Math.abs(pveDpsDiff).toFixed(2)}% ê°ì†Œ</span>`;
        else pveEl.innerHTML = `<span class="neu">- ë”œëŸ‰ ë³€í™” ì—†ìŒ -</span>`;

        let oPveResMult = (1 - base.genRes/100) * (1 - base.pveRes/100);
        let nPveResMult = (1 - (base.genRes + delta.genRes)/100) * (1 - (base.pveRes + delta.pveRes)/100);
        let enemyPveAmpMult = 1 + base.enemyAmp/100;
        
        let oPveIncoming = base.enemyAtk * enemyPveAmpMult * oPveResMult;
        let nPveIncoming = base.enemyAtk * enemyPveAmpMult * nPveResMult;

        let oPveDmgTaken = Math.max(1, oPveIncoming - (oDef / 10));
        let nPveDmgTaken = Math.max(1, nPveIncoming - (nDef / 10));

        let oPveSurvHits = oHp / oPveDmgTaken;
        let nPveSurvHits = nHp / nPveDmgTaken;

        document.getElementById('pve-def').innerHTML = formatDiff(oDef, nDef);
        document.getElementById('pve-hp').innerHTML = formatDiff(oHp, nHp);
        document.getElementById('pve-incoming').innerHTML = formatDmgDiff(oPveIncoming, nPveIncoming);
        document.getElementById('pve-dmg-taken').innerHTML = formatDmgDiff(oPveDmgTaken, nPveDmgTaken);

        let pveSurvHitsDiff = nPveSurvHits - oPveSurvHits;
        const pveSurvEl = document.getElementById('pve-final-surv');
        if(pveSurvHitsDiff > 0.05) pveSurvEl.innerHTML = `<span class="pos">âœ… ë™ì¼ ê³µê²©ì— ëŒ€í•´ ì•½ ${pveSurvHitsDiff.toFixed(1)}ëŒ€ ë” ë²„íŒ€! (ìƒì¡´ë ¥ ìƒìŠ¹)</span>`;
        else if(pveSurvHitsDiff < -0.05) pveSurvEl.innerHTML = `<span class="neg">âŒ ë™ì¼ ê³µê²©ì— ëŒ€í•´ ì•½ ${Math.abs(pveSurvHitsDiff).toFixed(1)}ëŒ€ ëœ ë²„íŒ€ (ìƒì¡´ë ¥ í•˜ë½)</span>`;
        else pveSurvEl.innerHTML = `<span class="neu">- ì¢…í•© ìƒì¡´ë ¥ ë³€í™” ì—†ìŒ -</span>`;

        let oPvpAtk = base.atk; 
        let nPvpAtk = (base.atk + delta.atk) * (1 + (delta.atkPct||0)/100);

        let oPvpAmpSum = (base.amp + base.pvpAmp + oSetEff.pvpAmp) / 100;
        let nPvpAmpSum = (base.amp + base.pvpAmp + delta.amp + delta.pvpAmp + nSetEff.pvpAmp) / 100;

        let pvpResFactor = (1 - base.enemyGenRes/100) * (1 - base.enemyPvpRes/100);
        let oPvpMult = Math.max(0.1, (1 + oPvpAmpSum) * (1 + oWeaponAmp) * pvpResFactor); 
        let nPvpMult = Math.max(0.1, (1 + nPvpAmpSum) * (1 + nWeaponAmp) * pvpResFactor);
        
        let oPvpReal = oPvpAtk * oPvpMult; 
        let nPvpReal = nPvpAtk * nPvpMult;

        document.getElementById('pvp-atk').innerHTML = formatDiff(oPvpAtk, nPvpAtk);
        document.getElementById('pvp-amp').innerHTML = formatDiff(oPvpAmpSum*100, nPvpAmpSum*100, true);
        document.getElementById('pvp-mult').innerHTML = formatMultDiff(oPvpMult, nPvpMult);
        
        let pvpRealDiff = nPvpReal - oPvpReal;
        document.getElementById('pvp-real-atk').innerHTML = `${oPvpReal.toFixed(0)} â¡ ${nPvpReal.toFixed(0)} <span style="font-size:14px;" class="${pvpRealDiff>0?'pos':(pvpRealDiff<0?'neg':'neu')}">(${pvpRealDiff>0?'â–²':'â–¼'}${Math.abs(pvpRealDiff).toFixed(0)})</span>`;

        let oPvpCritReal = oPvpReal * oCritMult; let nPvpCritReal = nPvpReal * nCritMult;
        let pvpDpsDiff = (oPvpCritReal > 0) ? ((nPvpCritReal / oPvpCritReal) - 1) * 100 : 0;
        
        const pvpEl = document.getElementById('pvp-final-dps');
        if(pvpDpsDiff > 0) pvpEl.innerHTML = `<span class="pos">â–² ì¹˜ëª…íƒ€ ì ì¤‘ ì‹œ ì‹¤ì§ˆ ë”œëŸ‰ ${pvpDpsDiff.toFixed(2)}% ì¦ê°€</span>`;
        else if(pvpDpsDiff < 0) pvpEl.innerHTML = `<span class="neg">â–¼ ì¹˜ëª…íƒ€ ì ì¤‘ ì‹œ ì‹¤ì§ˆ ë”œëŸ‰ ${Math.abs(pvpDpsDiff).toFixed(2)}% ê°ì†Œ</span>`;
        else pvpEl.innerHTML = `<span class="neu">- ë”œëŸ‰ ë³€í™” ì—†ìŒ -</span>`;

        let oPvpResMult = (1 - base.genRes/100) * (1 - base.pvpRes/100);
        let nPvpResMult = (1 - (base.genRes + delta.genRes)/100) * (1 - (base.pvpRes + delta.pvpRes)/100);
        let enemyPvpAmpMult = 1 + (base.enemyAmp + base.enemyPvpAmp)/100;
        
        let oPvpIncoming = base.enemyAtk * enemyPvpAmpMult * oPvpResMult;
        let nPvpIncoming = base.enemyAtk * enemyPvpAmpMult * nPvpResMult;

        let oPvpDmgTaken = Math.max(1, oPvpIncoming - (oDef / 10));
        let nPvpDmgTaken = Math.max(1, nPvpIncoming - (nDef / 10));

        let oPvpSurvHits = oHp / oPvpDmgTaken;
        let nPvpSurvHits = nHp / nPvpDmgTaken;

        document.getElementById('pvp-def').innerHTML = formatDiff(oDef, nDef);
        document.getElementById('pvp-hp').innerHTML = formatDiff(oHp, nHp);
        document.getElementById('pvp-incoming').innerHTML = formatDmgDiff(oPvpIncoming, nPvpIncoming);
        document.getElementById('pvp-dmg-taken').innerHTML = formatDmgDiff(oPvpDmgTaken, nPvpDmgTaken);

        let pvpSurvHitsDiff = nPvpSurvHits - oPvpSurvHits;
        const pvpSurvEl = document.getElementById('pvp-final-surv');
        if(pvpSurvHitsDiff > 0.05) pvpSurvEl.innerHTML = `<span class="pos">âœ… ë™ì¼ ê³µê²©ì— ëŒ€í•´ ì•½ ${pvpSurvHitsDiff.toFixed(1)}ëŒ€ ë” ë²„íŒ€! (ìƒì¡´ë ¥ ìƒìŠ¹)</span>`;
        else if(pvpSurvHitsDiff < -0.05) pvpSurvEl.innerHTML = `<span class="neg">âŒ ë™ì¼ ê³µê²©ì— ëŒ€í•´ ì•½ ${Math.abs(pvpSurvHitsDiff).toFixed(1)}ëŒ€ ëœ ë²„íŒ€ (ìƒì¡´ë ¥ í•˜ë½)</span>`;
        else pvpSurvEl.innerHTML = `<span class="neu">- ì¢…í•© ìƒì¡´ë ¥ ë³€í™” ì—†ìŒ -</span>`;
    }

    function saveStatPreset(slot) {
        const preset = {
            baseAtk: document.getElementById('baseAtk').value,
            baseAmp: document.getElementById('baseAmp').value,
            basePveAmp: document.getElementById('basePveAmp').value,
            basePvpAmp: document.getElementById('basePvpAmp').value,
            baseWAmp: document.getElementById('baseWAmp').value,
            baseCritDmg: document.getElementById('baseCritDmg').value,
            baseDef: document.getElementById('baseDef').value,
            baseHp: document.getElementById('baseHp').value,
            baseGenRes: document.getElementById('baseGenRes').value,
            basePveRes: document.getElementById('basePveRes').value,
            basePvpRes: document.getElementById('basePvpRes').value,
            enemyAtk: document.getElementById('enemyAtk').value,
            enemyGenRes: document.getElementById('enemyGenRes').value,
            enemyPvpRes: document.getElementById('enemyPvpRes').value,
            enemyAmp: document.getElementById('enemyAmp').value,
            enemyPvpAmp: document.getElementById('enemyPvpAmp').value,
            basePower: document.getElementById('basePower').value,
            baseAgi: document.getElementById('baseAgi').value,
            baseAccStat: document.getElementById('baseAccStat').value,
            baseWill: document.getElementById('baseWill').value,
            baseKnow: document.getElementById('baseKnow').value,
            baseVit: document.getElementById('baseVit').value,
            baseDest: document.getElementById('baseDest').value,
            baseDeath: document.getElementById('baseDeath').value,
            baseWis: document.getElementById('baseWis').value,
            baseDestiny: document.getElementById('baseDestiny').value,
            baseSpace: document.getElementById('baseSpace').value,
            baseTime: document.getElementById('baseTime').value,
            baseLife: document.getElementById('baseLife').value,
            baseIllusion: document.getElementById('baseIllusion').value,
            baseFreedom: document.getElementById('baseFreedom').value,
            baseJustice: document.getElementById('baseJustice').value
        };
        localStorage.setItem(`aion2_stat_preset_${slot}`, JSON.stringify(preset));
        alert(`âœ… ${slot}ë²ˆ í”„ë¦¬ì…‹ ìŠ¬ë¡¯ì— ë‚´ ìŠ¤íƒ¯ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }

    function loadStatPreset(slot, isInitial = false) {
        const saved = localStorage.getItem(`aion2_stat_preset_${slot}`);
        if(saved) {
            try {
                const preset = JSON.parse(saved);
                if(preset.baseAtk !== undefined) document.getElementById('baseAtk').value = preset.baseAtk;
                if(preset.baseAmp !== undefined) document.getElementById('baseAmp').value = preset.baseAmp;
                if(preset.basePveAmp !== undefined) document.getElementById('basePveAmp').value = preset.basePveAmp;
                if(preset.basePvpAmp !== undefined) document.getElementById('basePvpAmp').value = preset.basePvpAmp;
                if(preset.baseWAmp !== undefined) document.getElementById('baseWAmp').value = preset.baseWAmp;
                if(preset.baseCritDmg !== undefined) document.getElementById('baseCritDmg').value = preset.baseCritDmg;
                if(preset.baseDef !== undefined) document.getElementById('baseDef').value = preset.baseDef;
                if(preset.baseHp !== undefined) document.getElementById('baseHp').value = preset.baseHp;
                if(preset.baseGenRes !== undefined) document.getElementById('baseGenRes').value = preset.baseGenRes;
                if(preset.basePveRes !== undefined) document.getElementById('basePveRes').value = preset.basePveRes;
                if(preset.basePvpRes !== undefined) document.getElementById('basePvpRes').value = preset.basePvpRes;
                if(preset.enemyAtk !== undefined) document.getElementById('enemyAtk').value = preset.enemyAtk;
                if(preset.enemyGenRes !== undefined) document.getElementById('enemyGenRes').value = preset.enemyGenRes;
                if(preset.enemyPvpRes !== undefined) document.getElementById('enemyPvpRes').value = preset.enemyPvpRes;
                if(preset.enemyAmp !== undefined) document.getElementById('enemyAmp').value = preset.enemyAmp;
                if(preset.enemyPvpAmp !== undefined) document.getElementById('enemyPvpAmp').value = preset.enemyPvpAmp;
                
                if(preset.basePower !== undefined) document.getElementById('basePower').value = preset.basePower;
                if(preset.baseAgi !== undefined) document.getElementById('baseAgi').value = preset.baseAgi;
                if(preset.baseAccStat !== undefined) document.getElementById('baseAccStat').value = preset.baseAccStat;
                if(preset.baseWill !== undefined) document.getElementById('baseWill').value = preset.baseWill;
                if(preset.baseKnow !== undefined) document.getElementById('baseKnow').value = preset.baseKnow;
                if(preset.baseVit !== undefined) document.getElementById('baseVit').value = preset.baseVit;
                if(preset.baseDest !== undefined) document.getElementById('baseDest').value = preset.baseDest;
                if(preset.baseDeath !== undefined) document.getElementById('baseDeath').value = preset.baseDeath;
                if(preset.baseWis !== undefined) document.getElementById('baseWis').value = preset.baseWis;
                if(preset.baseDestiny !== undefined) document.getElementById('baseDestiny').value = preset.baseDestiny;
                if(preset.baseSpace !== undefined) document.getElementById('baseSpace').value = preset.baseSpace;
                if(preset.baseTime !== undefined) document.getElementById('baseTime').value = preset.baseTime;
                if(preset.baseLife !== undefined) document.getElementById('baseLife').value = preset.baseLife;
                if(preset.baseIllusion !== undefined) document.getElementById('baseIllusion').value = preset.baseIllusion;
                if(preset.baseFreedom !== undefined) document.getElementById('baseFreedom').value = preset.baseFreedom;
                if(preset.baseJustice !== undefined) document.getElementById('baseJustice').value = preset.baseJustice;

                updateDeltaDashboard();
                if(!isInitial) alert(`ğŸ“‚ ${slot}ë²ˆ í”„ë¦¬ì…‹ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`);
            } catch(e) { console.error("í”„ë¦¬ì…‹ ë¡œë“œ ì‹¤íŒ¨"); }
        } else {
            if(!isInitial) alert(`âŒ ${slot}ë²ˆ í”„ë¦¬ì…‹ì€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ìŠ¤íƒ¯ì„ ì €ì¥í•´ì£¼ì„¸ìš”!`);
        }
    }

    function renderFavorites() {
        const favList = JSON.parse(localStorage.getItem('aion2_favorites')) || [];
        const container = document.getElementById('favoriteList');
        container.innerHTML = '';
        if (favList.length === 0) {
            container.innerHTML = `<span style="color:#666; font-size:12px;">ê²€ìƒ‰ ê²°ê³¼ì—ì„œ 'â­ ì €ì¥'ì„ ëˆŒëŸ¬ ìì£¼ ë³´ëŠ” ìºë¦­í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</span>`;
            return;
        }
        favList.forEach(fav => {
            const fBtn = document.createElement('div');
            fBtn.style.cssText = "display:flex; align-items:stretch; background:#222; border:1px solid #444; border-radius:6px; overflow:hidden;";
            
            const loadDiv = document.createElement('div');
            loadDiv.style.cssText = "padding:6px 10px; cursor:pointer; font-size:12px; font-weight:bold; color:#fff; display:flex; align-items:center; transition:0.2s;";
            loadDiv.innerHTML = `<span style="color:#4fc3f7; margin-right:4px;">[${fav.serverName}]</span> ${fav.charName}`;
            loadDiv.onmouseover = () => loadDiv.style.background = "#2a2a35";
            loadDiv.onmouseout = () => loadDiv.style.background = "transparent";
            loadDiv.onclick = () => loadCharacterDetail(fav.charId, fav.serverId, fav.charName);
            
            const delDiv = document.createElement('div');
            delDiv.style.cssText = "padding:6px 8px; cursor:pointer; background:#333; color:#ff5252; font-size:12px; display:flex; align-items:center; transition:0.2s;";
            delDiv.innerHTML = "âœ–";
            delDiv.onmouseover = () => delDiv.style.background = "#555";
            delDiv.onmouseout = () => delDiv.style.background = "#333";
            delDiv.onclick = () => removeFavorite(fav.charId);

            fBtn.appendChild(loadDiv);
            fBtn.appendChild(delDiv);
            container.appendChild(fBtn);
        });
    }

    function addFavorite(charId, serverId, charName, serverName, className) {
        let favList = JSON.parse(localStorage.getItem('aion2_favorites')) || [];
        if (favList.find(f => f.charId === charId)) {
            alert("ì´ë¯¸ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ëœ ìºë¦­í„°ì…ë‹ˆë‹¤!");
            return;
        }
        favList.push({ charId, serverId, charName, serverName, className });
        localStorage.setItem('aion2_favorites', JSON.stringify(favList));
        renderFavorites();
        alert(`â­ [${serverName}] ${charName} ìºë¦­í„°ê°€ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }

    function removeFavorite(charId) {
        let favList = JSON.parse(localStorage.getItem('aion2_favorites')) || [];
        favList = favList.filter(f => f.charId !== charId);
        localStorage.setItem('aion2_favorites', JSON.stringify(favList));
        renderFavorites();
    }

    // ==========================================
    // ğŸ—‚ï¸ ì¹´í…Œê³ ë¦¬ íƒ­ ì „í™˜ ë¡œì§
    // ==========================================
    function switchTab(tabId, element) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        element.classList.add('active');
    }

    // ==========================================
    // ğŸ¾ í« ê³„ì‚°ê¸° ë°ì´í„° ë° ë¡œì§
    const PET_CATS = [{n:'ì§€ì„±',c:'#4fc3f7'}, {n:'ì•¼ì„±',c:'#ff5252'}, {n:'ìì—°',c:'#69f0ae'}, {n:'ë³€í˜•',c:'#ce93d8'}, {n:'íŠ¹ìˆ˜',c:'#ffca28'}];
    const PET_EXP = [0, 1000, 3000, 6000, 10000, 20000, 40000, 80000, 140000, 200000];
    const PET_PENALTY = [{c:0,k:0},{c:5,k:1000},{c:5,k:1000},{c:20,k:4000},{c:45,k:9000},{c:95,k:19000},{c:95,k:19000},{c:95,k:19000},{c:95,k:19000},{c:95,k:19000},{c:95,k:19000}];

    function initPetCalc() {
        let html = '';
        PET_CATS.forEach((cat, i) => {
            html += `<tr style="background:#0a0a0c; border-bottom:1px solid #1a1a20;">
                <td style="padding:10px; text-align:center; font-weight:bold; color:${cat.c}">${cat.n}</td>
                <td><input type="number" id="curLv_${i}" value="1" min="1" max="10" style="width:80%; background:#111; border:1px solid #333; color:#fff; padding:5px; text-align:center;" oninput="if(this.value>10)this.value=10; runPetCalc()"></td>
                <td><input type="number" id="curLv_${i}" value="1" style="width:80%; background:#111; border:1px solid #333; color:#fff; padding:5px; text-align:center;" oninput="runPetCalc()"></td>
                <td><input type="number" id="curExp_${i}" value="0" style="width:80%; background:#111; border:1px solid #333; color:#fff; padding:5px; text-align:center;" oninput="runPetCalc()"></td>
                <td><input type="number" id="tarLv_${i}" value="1" style="width:80%; background:#111; border:1px solid #333; color:#fff; padding:5px; text-align:center;" oninput="runPetCalc()"></td>
                <td><select id="lock_${i}" style="width:90%; background:#111; border:1px solid #333; color:#fff; padding:5px;" onchange="runPetCalc()"><option value="0">0ê°œ</option><option value="1">1ê°œ</option><option value="2">2ê°œ</option><option value="3">3ê°œ</option><option value="4">4ê°œ</option><option value="5">5ê°œ</option><option value="6">6ê°œ</option><option value="7">7ê°œ</option><option value="8">8ê°œ</option></select></td>
            </tr>`;
        });
        document.getElementById('petTableBody').innerHTML = html;
    }

    function runPetCalc() {
        let tC = 0, tCry = 0, tK = 0;
        for(let i=0; i<5; i++) {
            let clv = parseInt(document.getElementById(`curLv_${i}`).value) || 1;
            let cex = parseInt(document.getElementById(`curExp_${i}`).value) || 0;
            let tlv = parseInt(document.getElementById(`tarLv_${i}`).value) || 1;
            let lock = parseInt(document.getElementById(`lock_${i}`).value) || 0;
            if(clv >= tlv) continue;
            for(let v = clv; v < tlv; v++) {
                let req = (v === clv) ? (PET_EXP[v] - cex) : PET_EXP[v];
                if(req <= 0) continue;
                let slot = v - lock;
                if(slot <= 0) continue;
                let click = Math.ceil(req / (slot * 100));
                tC += click;
                tCry += click * (v * 5 + PET_PENALTY[lock].c);
                tK += click * (v * 1000 + PET_PENALTY[lock].k);
            }
        }
        document.getElementById('res_clicks').innerText = tC.toLocaleString() + 'íšŒ';
        document.getElementById('res_crystal').innerText = tCry.toLocaleString() + 'ê°œ';
        document.getElementById('res_kinah').innerText = tK.toLocaleString();
        document.getElementById('res_mobs').innerText = tCry.toLocaleString() + 'ë§ˆë¦¬';
    }
    // ê¸°ì¡´ window.onloadì— ì¶”ê°€
    const oldLoad = window.onload;
    window.onload = () => { if(oldLoad) oldLoad(); initPetCalc(); };

    // ğŸ… ì–´ë¹„ìŠ¤ ë°ì´í„° ë° ë‹¤ì¤‘ ê³„ì‚° ë¡œì§
    const ABY_DATA = {
        10: { name: 'ì‹­ë¶€ì¥', color: '#fff', ap: {weapon:126200, top:84100, bottom:63100, head:52600, shoulder:52600, glove:42100, shoe:52600, cloak:42100, neck:52600, ear:42100, ring:31600}, mCount:{} },
        100: { name: 'ë°±ë¶€ì¥', color: '#69f0ae', ap: {weapon:409500, top:273000, bottom:204800, head:170600, shoulder:170600, glove:136500, shoe:170600, cloak:136500, neck:170600, ear:136500, ring:102400}, mCount:{weapon:50, top:35, bottom:25, head:20, shoulder:20, glove:15, shoe:20, cloak:15, neck:20, ear:15, ring:15} },
        1000: { name: 'ì²œë¶€ì¥', color: '#ffca28', ap: {weapon:1171500, top:781000, bottom:585800, head:488200, shoulder:488200, glove:390500, shoe:488200, cloak:390500, neck:488200, ear:40000, ring:30} }, // ë°˜ì§€ìˆ˜ì •
        10000: { name: 'êµ°ë‹¨ì¥', color: '#ff9800', ap: {weapon:3636300, top:2424200, bottom:1818200, head:1515100, shoulder:1515100, glove:1212100, shoe:1515100, cloak:1212100, neck:1515100, ear:1212100, ring:909100}, mCount:{weapon:240, top:160, bottom:120, head:100, shoulder:100, glove:80, shoe:100, cloak:80, neck:100, ear:80, ring:80} }
    };
    // ì²œë¶€ì¥ í›ˆì¥ ë°ì´í„° ë³´ì • (ì œê³µí•´ì£¼ì‹  ë°ì´í„° ê¸°ë°˜)
    ABY_DATA[1000].mCount = {weapon:120, top:80, bottom:60, head:50, shoulder:50, glove:40, shoe:50, cloak:40, neck:50, ear:40, ring:30};

    let abyCart = [];

    function addToCart() {
        const rank = document.getElementById('aby_rank').value;
        const part = document.getElementById('aby_part').value;
        const data = ABY_DATA[rank];
        const partName = document.getElementById('aby_part').options[document.getElementById('aby_part').selectedIndex].text;
        
        // ì•„ì´ì½˜ ì´ë¯¸ì§€ ì°¾ê¸° (ìºë¦­í„° ì •ë³´ì— ìˆìœ¼ë©´ ê°€ì ¸ì˜´)
        let iconUrl = 'https://via.placeholder.com/40/222/888?text=?';
        if(currentEquipData.length > 0) {
            const found = currentEquipData.find(e => getSmartCategory(e)?.key.includes(part === 'neck' ? 'necklace' : part === 'ear' ? 'earring' : part === 'ring' ? 'ring' : part));
            if(found) iconUrl = found.icon;
        }

        abyCart.push({
            id: Date.now(),
            rank: rank,
            rankName: data.name,
            part: part,
            partName: partName,
            ap: data.ap[part],
            medal: data.mCount[part] || 0,
            color: data.color,
            icon: iconUrl
        });
        renderAbyCart();
        calcAbyss();
    }

    function removeFromCart(id) {
        abyCart = abyCart.filter(item => item.id !== id);
        renderAbyCart();
        calcAbyss();
    }

    function renderAbyCart() {
        const container = document.getElementById('aby_cart_list');
        if(abyCart.length === 0) {
            container.innerHTML = `<p style="text-align:center; color:#444; font-size:12px; margin-top:60px;">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>`;
            return;
        }
        let html = '';
        abyCart.forEach(item => {
            html += `
            <div style="display:flex; align-items:center; gap:10px; background:#111; padding:8px; border-radius:6px; margin-bottom:8px; border:1px solid #333;">
                <img src="${item.icon}" style="width:32px; height:32px; border-radius:4px; border:1px solid #444;">
                <div style="flex:1;">
                    <div style="font-size:12px; font-weight:bold; color:${item.color}">${item.rankName} ${item.partName}</div>
                    <div style="font-size:10px; color:#888;">${item.ap.toLocaleString()} AP / ${item.medal} í›ˆì¥</div>
                </div>
                <button onclick="removeFromCart(${item.id})" style="background:none; border:none; color:#ff5252; cursor:pointer; font-weight:bold;">Ã—</button>
            </div>`;
        });
        container.innerHTML = html;
    }

    function calcAbyss() {
        // 1. ì£¼ê°„ í•œë„ ê³„ì‚° (2026-02-20 ê¸°ì¤€)
        const baseLimit = 5000000;
        const myAp = parseInt(document.getElementById('my_ap').value) || 0;
        const remainLimit = Math.max(0, baseLimit - myAp);
        document.getElementById('remain_limit_text').innerText = `í•œë„ê¹Œì§€ ë‚¨ì€ íšë“ ê°€ëŠ¥ ì–´í¬: ${remainLimit.toLocaleString()} AP`;

        if(abyCart.length === 0) {
            document.getElementById('aby_res_time').innerText = "0ì£¼";
            document.getElementById('aby_res_desc').innerText = "ëª©í‘œ ì¥ë¹„ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.";
            return;
        }

        // 2. ì´ í•„ìš” ìì› í•©ì‚°
        let totalAp = 0;
        let totalMedal = 0;
        let targetRank = abyCart[0].rank; // ì²« ë²ˆì§¸ ì¥ë¹„ ê¸°ì¤€ í›ˆì¥ ì¢…ë¥˜ íŒë‹¨

        abyCart.forEach(item => {
            totalAp += item.ap;
            totalMedal += item.medal;
        });

        let myM = 0;
        if (targetRank == 100) myM = parseInt(document.getElementById('my_medal_silver').value) || 0;
        else if (targetRank == 1000) myM = parseInt(document.getElementById('my_medal_gold').value) || 0;
        else if (targetRank == 10000) myM = parseInt(document.getElementById('my_medal_plat').value) || 0;
        const wAp = parseInt(document.getElementById('week_ap').value) || 0;
        const useApBuy = document.getElementById('buy_medal_ap').checked;
        const useMake = document.getElementById('make_medal').checked;

        let remAp = Math.max(0, totalAp - myAp);
        let remM = Math.max(0, totalMedal - myM);

        // ì£¼ê°„ í›ˆì¥ ë° ì–´í¬ ì†Œëª¨ëŸ‰ ê¸°ëŒ€ê°’
        let weeklyMedal = (targetRank == 100 ? 9 : targetRank == 1000 ? 8 : 0);
        let weeklyApCost = 0;

        if(targetRank >= 100) {
            if(useApBuy) { weeklyMedal += 10; weeklyApCost += (targetRank == 100 ? 100000 : 300000); }
            if(useMake) { weeklyMedal += (targetRank == 100 ? 2 : 4); }
        }

        let weeksForAp = (wAp - weeklyApCost > 0) ? Math.ceil(remAp / (wAp - weeklyApCost)) : 999;
        let weeksForMedal = (weeklyMedal > 0) ? Math.ceil(remM / weeklyMedal) : (remM > 0 ? 999 : 0);
        let finalWeeks = Math.max(weeksForAp, weeksForMedal);

        document.getElementById('aby_res_time').innerText = `ì•½ ${finalWeeks}ì£¼`;
        document.getElementById('aby_res_desc').innerText = `ì´ í•„ìš”: ${totalAp.toLocaleString()} AP / ${totalMedal} í›ˆì¥`;
    }

    // íƒ­ ì „í™˜ ì‹œ ì´ˆê¸°í™”
    const oldSwitch = switchTab;
    switchTab = (id, el) => {
        oldSwitch(id, el);
        if(id === 'abyss') calcAbyss();
    };
</script>

</body>
</html>









